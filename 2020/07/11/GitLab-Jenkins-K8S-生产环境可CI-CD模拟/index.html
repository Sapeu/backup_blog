<!DOCTYPE html><html class="theme-next pisces use-motion" lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  












  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">


  <link rel="mask-icon" href="/images/logo.svg" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.4.1',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    fastclick: true,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="该文档复制自 Docker+k8s+GitLab+Jenkins (生产环境可 CI/CD 模拟) 这个环境仅做参考 通过 Docker+k8s 来部署 web 集群，GitLab+Jenkins 实现代码自动化部署，在 Jenkins 中通过构建脚本，实现 k8s 对容器 web 集群代码自动更新  运行环境   ip  服务 备注      192.168.1.1 GitLab  内存 4G，">
<meta name="keywords" content="GitLab,Jenkins,K8S">
<meta property="og:type" content="article">
<meta property="og:title" content="GitLab+Jenkins+K8S (生产环境可 CI/CD 模拟)">
<meta property="og:url" content="https://blog.q-moe.com/2020/07/11/GitLab-Jenkins-K8S-生产环境可CI-CD模拟/index.html">
<meta property="og:site_name" content="0x0">
<meta property="og:description" content="该文档复制自 Docker+k8s+GitLab+Jenkins (生产环境可 CI/CD 模拟) 这个环境仅做参考 通过 Docker+k8s 来部署 web 集群，GitLab+Jenkins 实现代码自动化部署，在 Jenkins 中通过构建脚本，实现 k8s 对容器 web 集群代码自动更新  运行环境   ip  服务 备注      192.168.1.1 GitLab  内存 4G，">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://www.feiyiblog.com/uploads/set_password.png">
<meta property="og:image" content="https://www.feiyiblog.com/uploads/first_login.png">
<meta property="og:image" content="https://www.feiyiblog.com/uploads/gitlab_login.png">
<meta property="og:image" content="https://www.feiyiblog.com/uploads/wait_jiemian.png">
<meta property="og:image" content="https://www.feiyiblog.com/uploads/lock_jenkins.png">
<meta property="og:image" content="https://www.feiyiblog.com/uploads/shaowait.png">
<meta property="og:image" content="https://www.feiyiblog.com/uploads/lixian.png">
<meta property="og:image" content="https://www.feiyiblog.com/uploads/install_chajian.png">
<meta property="og:image" content="https://www.feiyiblog.com/uploads/wait_install.png">
<meta property="og:image" content="https://www.feiyiblog.com/uploads/create_jenkins_user.png">
<meta property="og:image" content="https://www.feiyiblog.com/uploads/shili_config.png">
<meta property="og:image" content="https://www.feiyiblog.com/uploads/jenkins_install_success.png">
<meta property="og:image" content="https://jf.ssjinyao.com/uploads/k8s_nginx.png">
<meta property="og:image" content="https://jf.ssjinyao.com/uploads/admin_create_project.png">
<meta property="og:image" content="https://jf.ssjinyao.com/uploads/k8s_gitlab.png">
<meta property="og:image" content="https://jf.ssjinyao.com/uploads/add_id_rsa_pub.png">
<meta property="og:image" content="https://jf.ssjinyao.com/uploads/k8s_gitlab1.png">
<meta property="og:image" content="https://jf.ssjinyao.com/uploads/k8s_gitlab2.png">
<meta property="og:image" content="https://jf.ssjinyao.com/uploads/k8s_gitlab3.png">
<meta property="og:image" content="https://jf.ssjinyao.com/uploads/k8s_jenkins.png">
<meta property="og:image" content="https://jf.ssjinyao.com/uploads/k8s_jenkins2.png">
<meta property="og:image" content="https://www.feiyiblog.com/uploads/create_con_gitlab.png">
<meta property="og:image" content="https://www.feiyiblog.com/uploads/choose_pingzheng_gitlab.png">
<meta property="og:image" content="https://jf.ssjinyao.com/uploads/k8s_jenkins3.png">
<meta property="og:image" content="https://www.feiyiblog.com/uploads/sheng_token.png">
<meta property="og:image" content="https://jf.ssjinyao.com/uploads/k8s_build.png">
<meta property="og:image" content="https://www.feiyiblog.com/uploads/admin_settings_integrations.png">
<meta property="og:image" content="https://www.feiyiblog.com/uploads/outbound_requests.png">
<meta property="og:image" content="https://www.feiyiblog.com/uploads/allow_webhooks.png">
<meta property="og:image" content="https://www.feiyiblog.com/uploads/cd_reops_settings.png">
<meta property="og:image" content="https://jf.ssjinyao.com/uploads/gitlab_token.png">
<meta property="og:image" content="https://jf.ssjinyao.com/uploads/gitlab_webhooktest.png">
<meta property="og:image" content="https://jf.ssjinyao.com/uploads/gitlab_test.png">
<meta property="og:image" content="https://jf.ssjinyao.com/uploads/k8s_cicd.png">
<meta property="og:updated_time" content="2020-07-08T03:53:30.671Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="GitLab+Jenkins+K8S (生产环境可 CI/CD 模拟)">
<meta name="twitter:description" content="该文档复制自 Docker+k8s+GitLab+Jenkins (生产环境可 CI/CD 模拟) 这个环境仅做参考 通过 Docker+k8s 来部署 web 集群，GitLab+Jenkins 实现代码自动化部署，在 Jenkins 中通过构建脚本，实现 k8s 对容器 web 集群代码自动更新  运行环境   ip  服务 备注      192.168.1.1 GitLab  内存 4G，">
<meta name="twitter:image" content="https://www.feiyiblog.com/uploads/set_password.png">






  <link rel="canonical" href="https://blog.q-moe.com/2020/07/11/GitLab-Jenkins-K8S-生产环境可CI-CD模拟/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>GitLab+Jenkins+K8S (生产环境可 CI/CD 模拟) | 0x0</title>
  









  <style>/* normalize.css v3.0.2 | MIT License | git.io/normalize */
html {
  font-family: sans-serif; /* 1 */
  -ms-text-size-adjust: 100%; /* 2 */
  -webkit-text-size-adjust: 100%; /* 2 */
}
body {
  margin: 0;
}
article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
menu,
nav,
section,
summary {
  display: block;
}
audio,
canvas,
progress,
video {
  display: inline-block; /* 1 */
  vertical-align: baseline; /* 2 */
}
audio:not([controls]) {
  display: none;
  height: 0;
}
[hidden],
template {
  display: none;
}
a {
  background-color: transparent;
}
a:active,
a:hover {
  outline: 0;
}
abbr[title] {
  border-bottom: 1px dotted;
}
b,
strong {
  font-weight: bold;
}
dfn {
  font-style: italic;
}
h1 {
  font-size: 2em;
  margin: 0.67em 0;
}
mark {
  background: #ff0;
  color: #000;
}
small {
  font-size: 80%;
}
sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
sup {
  top: -0.5em;
}
sub {
  bottom: -0.25em;
}
img {
  border: 0;
}
svg:not(:root) {
  overflow: hidden;
}
figure {
  margin: 1em 40px;
}
hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}
pre {
  overflow: auto;
}
code,
kbd,
pre,
samp {
  font-family: monospace, monospace;
  font-size: 1em;
}
button,
input,
optgroup,
select,
textarea {
  color: inherit; /* 1 */
  font: inherit; /* 2 */
  margin: 0; /* 3 */
}
button {
  overflow: visible;
}
button,
select {
  text-transform: none;
}
button,
html input[type="button"],
input[type="reset"],
input[type="submit"] {
  -webkit-appearance: button; /* 2 */
  cursor: pointer; /* 3 */
}
button[disabled],
html input[disabled] {
  cursor: default;
}
button::-moz-focus-inner,
input::-moz-focus-inner {
  border: 0;
  padding: 0;
}
input {
  line-height: normal;
}
input[type="checkbox"],
input[type="radio"] {
  box-sizing: border-box; /* 1 */
  padding: 0; /* 2 */
}
input[type="number"]::-webkit-inner-spin-button,
input[type="number"]::-webkit-outer-spin-button {
  height: auto;
}
input[type="search"] {
  -webkit-appearance: textfield; /* 1 */
  -moz-box-sizing: content-box;
  -webkit-box-sizing: content-box; /* 2 */
  box-sizing: content-box;
}
input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
  -webkit-appearance: none;
}
fieldset {
  border: 1px solid #c0c0c0;
  margin: 0 2px;
  padding: 0.35em 0.625em 0.75em;
}
legend {
  border: 0; /* 1 */
  padding: 0; /* 2 */
}
textarea {
  overflow: auto;
}
optgroup {
  font-weight: bold;
}
table {
  border-collapse: collapse;
  border-spacing: 0;
}
td,
th {
  padding: 0;
}
::selection {
  background: #262a30;
  color: #fff;
}
body {
  position: relative;
  font-family: 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif;
  font-size: 14px;
  line-height: 2;
  color: #555;
  background: #f5f7f9;
}
@media (max-width: 767px) {
  body {
    padding-right: 0 !important;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  body {
    padding-right: 0 !important;
  }
}
@media (min-width: 1200px) {
  body {
    font-size: 16px;
  }
}
h1,
h2,
h3,
h4,
h5,
h6 {
  margin: 0;
  padding: 0;
  font-weight: bold;
  line-height: 1.5;
  font-family: 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif;
}
h1,
h2,
h3,
h4,
h5,
h6 {
  margin: 20px 0 15px;
}
h1 {
  font-size: 22px;
}
@media (max-width: 767px) {
  h1 {
    font-size: 18px;
  }
}
h2 {
  font-size: 20px;
}
@media (max-width: 767px) {
  h2 {
    font-size: 16px;
  }
}
h3 {
  font-size: 18px;
}
@media (max-width: 767px) {
  h3 {
    font-size: 14px;
  }
}
h4 {
  font-size: 16px;
}
@media (max-width: 767px) {
  h4 {
    font-size: 12px;
  }
}
h5 {
  font-size: 14px;
}
@media (max-width: 767px) {
  h5 {
    font-size: 10px;
  }
}
h6 {
  font-size: 12px;
}
@media (max-width: 767px) {
  h6 {
    font-size: 8px;
  }
}
p {
  margin: 0 0 20px 0;
}
a {
  color: #555;
  text-decoration: none;
  outline: none;
  border-bottom: 1px solid #999;
  word-wrap: break-word;
}
a:hover {
  color: #222;
  border-bottom-color: #222;
}
blockquote {
  margin: 0;
  padding: 0;
}
img {
  display: block;
  margin: auto;
  max-width: 100%;
  height: auto;
}
hr {
  margin: 40px 0;
  height: 3px;
  border: none;
  background-color: #ddd;
  background-image: repeating-linear-gradient(-45deg, #fff, #fff 4px, transparent 4px, transparent 8px);
}
blockquote {
  padding: 0 15px;
  color: #666;
  border-left: 4px solid #ddd;
}
blockquote cite::before {
  content: "-";
  padding: 0 5px;
}
dt {
  font-weight: 700;
}
dd {
  margin: 0;
  padding: 0;
}
kbd {
  border: 1px solid #ccc;
  border-radius: 0.2em;
  box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1);
  background-color: #f9f9f9;
  font-family: inherit;
  background-image: -webkit-linear-gradient(top, #eee, #fff, #eee);
  padding: 0.1em 0.3em;
  white-space: nowrap;
}
.text-left {
  text-align: left;
}
.text-center {
  text-align: center;
}
.text-right {
  text-align: right;
}
.text-justify {
  text-align: justify;
}
.text-nowrap {
  white-space: nowrap;
}
.text-lowercase {
  text-transform: lowercase;
}
.text-uppercase {
  text-transform: uppercase;
}
.text-capitalize {
  text-transform: capitalize;
}
.center-block {
  display: block;
  margin-left: auto;
  margin-right: auto;
}
.clearfix:before,
.clearfix:after {
  content: " ";
  display: table;
}
.clearfix:after {
  clear: both;
}
.pullquote {
  width: 45%;
}
.pullquote.left {
  float: left;
  margin-left: 5px;
  margin-right: 10px;
}
.pullquote.right {
  float: right;
  margin-left: 10px;
  margin-right: 5px;
}
.affix.affix.affix {
  position: fixed;
}
.translation {
  margin-top: -20px;
  font-size: 14px;
  color: #999;
}
.scrollbar-measure {
  width: 100px;
  height: 100px;
  overflow: scroll;
  position: absolute;
  top: -9999px;
}
.use-motion .motion-element {
  opacity: 0;
}
table {
  margin: 20px 0;
  width: 100%;
  border-collapse: collapse;
  border-spacing: 0;
  border: 1px solid #ddd;
  font-size: 14px;
  word-wrap: break-all;
}
table>tbody>tr:nth-of-type(odd) {
  background-color: #f9f9f9;
}
table>tbody>tr:hover {
  background-color: #f5f5f5;
}
caption,
th,
td {
  padding: 8px;
  text-align: left;
  vertical-align: middle;
  font-weight: normal;
}
th,
td {
  border-bottom: 3px solid #ddd;
  border-right: 1px solid #eee;
}
th {
  padding-bottom: 10px;
  font-weight: 700;
}
td {
  border-bottom-width: 1px;
}
html,
body {
  height: 100%;
}
.container {
  position: relative;
  min-height: 100%;
}
.header-inner {
  margin: 0 auto;
  padding: 100px 0 70px;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .container .header-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .container .header-inner {
    width: 73%;
  }
}
.main {
  padding-bottom: 150px;
}
.main-inner {
  margin: 0 auto;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .container .main-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .container .main-inner {
    width: 73%;
  }
}
.footer {
  position: absolute;
  left: 0;
  bottom: 0;
  width: 100%;
  min-height: 50px;
}
.footer-inner {
  box-sizing: border-box;
  margin: 20px auto;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .container .footer-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .container .footer-inner {
    width: 73%;
  }
}
pre,
.highlight {
  overflow: auto;
  margin: 20px 0;
  padding: 0;
  font-size: 14px;
  color: #4d4d4c;
  background: #f7f7f7;
  line-height: 1.6;
}
pre,
code {
  font-family: consolas, Menlo, "PingFang SC", "Microsoft YaHei", monospace;
}
code {
  padding: 2px 4px;
  word-wrap: break-word;
  color: #555;
  background: #eee;
  border-radius: 3px;
  font-size: 14px;
}
pre {
  padding: 10px;
}
pre code {
  padding: 0;
  color: #4d4d4c;
  background: none;
  text-shadow: none;
}
.highlight {
  border-radius: 1px;
}
.highlight pre {
  border: none;
  margin: 0;
  padding: 10px 0;
}
.highlight table {
  margin: 0;
  width: auto;
  border: none;
}
.highlight td {
  border: none;
  padding: 0;
}
.highlight figcaption {
  font-size: 1em;
  color: #4d4d4c;
  line-height: 1em;
  margin-bottom: 1em;
  margin: 0em;
  padding: 0.5em;
  background: #eee;
  border-bottom: 1px solid #e9e9e9;
}
.highlight figcaption:before,
.highlight figcaption:after {
  content: " ";
  display: table;
}
.highlight figcaption:after {
  clear: both;
}
.highlight figcaption a {
  float: right;
  color: #4d4d4c;
}
.highlight figcaption a:hover {
  border-bottom-color: #4d4d4c;
}
.highlight .gutter pre {
  padding-left: 10px;
  padding-right: 10px;
  color: #869194;
  text-align: right;
  background-color: #eff2f3;
}
.highlight .code pre {
  width: 100%;
  padding-left: 10px;
  padding-right: 10px;
  background-color: #f7f7f7;
}
.highlight .line {
  height: 20px;
}
.gutter {
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
.gist table {
  width: auto;
}
.gist table td {
  border: none;
}
pre .deletion {
  background: #fdd;
}
pre .addition {
  background: #dfd;
}
pre .meta {
  color: #8959a8;
}
pre .comment {
  color: #8e908c;
}
pre .variable,
pre .attribute,
pre .tag,
pre .regexp,
pre .ruby .constant,
pre .xml .tag .title,
pre .xml .pi,
pre .xml .doctype,
pre .html .doctype,
pre .css .id,
pre .css .class,
pre .css .pseudo {
  color: #c82829;
}
pre .number,
pre .preprocessor,
pre .built_in,
pre .literal,
pre .params,
pre .constant,
pre .command {
  color: #f5871f;
}
pre .ruby .class .title,
pre .css .rules .attribute,
pre .string,
pre .value,
pre .inheritance,
pre .header,
pre .ruby .symbol,
pre .xml .cdata,
pre .special,
pre .number,
pre .formula {
  color: #718c00;
}
pre .title,
pre .css .hexcolor {
  color: #3e999f;
}
pre .function,
pre .python .decorator,
pre .python .title,
pre .ruby .function .title,
pre .ruby .title .keyword,
pre .perl .sub,
pre .javascript .title,
pre .coffeescript .title {
  color: #4271ae;
}
pre .keyword,
pre .javascript .function {
  color: #8959a8;
}
.posts-expand .post-body img.full-image {
  border: none;
}
.blockquote-center,
.page-home .post-type-quote blockquote,
.page-post-detail .post-type-quote blockquote {
  position: relative;
  margin: 40px 0;
  padding: 0;
  border-left: none;
  text-align: center;
}
.blockquote-center::before,
.page-home .post-type-quote blockquote::before,
.page-post-detail .post-type-quote blockquote::before,
.blockquote-center::after,
.page-home .post-type-quote blockquote::after,
.page-post-detail .post-type-quote blockquote::after {
  position: absolute;
  content: ' ';
  display: block;
  width: 100%;
  height: 24px;
  opacity: 0.2;
  background-repeat: no-repeat;
  background-position: 0 -6px;
  background-size: 22px 22px;
}
.blockquote-center::before,
.page-home .post-type-quote blockquote::before,
.page-post-detail .post-type-quote blockquote::before {
  top: -20px;
  background-image: url("../images/quote-l.svg");
  border-top: 1px solid #ccc;
}
.blockquote-center::after,
.page-home .post-type-quote blockquote::after,
.page-post-detail .post-type-quote blockquote::after {
  bottom: -20px;
  background-image: url("../images/quote-r.svg");
  border-bottom: 1px solid #ccc;
  background-position: 100% 8px;
}
.blockquote-center p,
.page-home .post-type-quote blockquote p,
.page-post-detail .post-type-quote blockquote p,
.blockquote-center div,
.page-home .post-type-quote blockquote div,
.page-post-detail .post-type-quote blockquote div {
  text-align: center;
}
.post .post-body .group-picture img {
  box-sizing: border-box;
  padding: 0 3px;
  border: none;
}
.post .group-picture-row {
  overflow: hidden;
  margin-top: 6px;
}
.post .group-picture-row:first-child {
  margin-top: 0;
}
.post .group-picture-column {
  float: left;
}
.page-post-detail .post-body .group-picture-column {
  float: none;
  margin-top: 10px;
  width: auto !important;
}
.page-post-detail .post-body .group-picture-column img {
  margin: 0 auto;
}
.page-archive .group-picture-container {
  overflow: hidden;
}
.page-archive .group-picture-row {
  float: left;
}
.page-archive .group-picture-row:first-child {
  margin-top: 6px;
}
.page-archive .group-picture-column {
  max-width: 150px;
  max-height: 150px;
}
.post-body .note {
  position: relative;
  padding: 15px;
  margin-bottom: 20px;
  border: 1px solid #eee;
  border-left-width: 5px;
  border-radius: 3px;
}
.post-body .note h2,
.post-body .note h3,
.post-body .note h4,
.post-body .note h5,
.post-body .note h6 {
  margin-top: 0;
  margin-bottom: 0;
  border-bottom: initial;
  padding-top: 0 !important;
}
.post-body .note p:first-child,
.post-body .note ul:first-child,
.post-body .note ol:first-child,
.post-body .note table:first-child,
.post-body .note pre:first-child,
.post-body .note blockquote:first-child {
  margin-top: 0;
}
.post-body .note p:last-child,
.post-body .note ul:last-child,
.post-body .note ol:last-child,
.post-body .note table:last-child,
.post-body .note pre:last-child,
.post-body .note blockquote:last-child {
  margin-bottom: 0;
}
.post-body .note.default {
  border-left-color: #777;
}
.post-body .note.default h2,
.post-body .note.default h3,
.post-body .note.default h4,
.post-body .note.default h5,
.post-body .note.default h6 {
  color: #777;
}
.post-body .note.primary {
  border-left-color: #6f42c1;
}
.post-body .note.primary h2,
.post-body .note.primary h3,
.post-body .note.primary h4,
.post-body .note.primary h5,
.post-body .note.primary h6 {
  color: #6f42c1;
}
.post-body .note.info {
  border-left-color: #428bca;
}
.post-body .note.info h2,
.post-body .note.info h3,
.post-body .note.info h4,
.post-body .note.info h5,
.post-body .note.info h6 {
  color: #428bca;
}
.post-body .note.success {
  border-left-color: #5cb85c;
}
.post-body .note.success h2,
.post-body .note.success h3,
.post-body .note.success h4,
.post-body .note.success h5,
.post-body .note.success h6 {
  color: #5cb85c;
}
.post-body .note.warning {
  border-left-color: #f0ad4e;
}
.post-body .note.warning h2,
.post-body .note.warning h3,
.post-body .note.warning h4,
.post-body .note.warning h5,
.post-body .note.warning h6 {
  color: #f0ad4e;
}
.post-body .note.danger {
  border-left-color: #d9534f;
}
.post-body .note.danger h2,
.post-body .note.danger h3,
.post-body .note.danger h4,
.post-body .note.danger h5,
.post-body .note.danger h6 {
  color: #d9534f;
}
.post-body .label {
  display: inline;
  padding: 0 2px;
  white-space: nowrap;
}
.post-body .label.default {
  background-color: #f0f0f0;
}
.post-body .label.primary {
  background-color: #efe6f7;
}
.post-body .label.info {
  background-color: #e5f2f8;
}
.post-body .label.success {
  background-color: #e7f4e9;
}
.post-body .label.warning {
  background-color: #fcf6e1;
}
.post-body .label.danger {
  background-color: #fae8eb;
}
.post-body .tabs {
  position: relative;
  display: block;
  margin-bottom: 20px;
  padding-top: 10px;
}
.post-body .tabs ul.nav-tabs {
  margin: 0;
  padding: 0;
  display: flex;
  margin-bottom: -1px;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs {
    display: block;
    margin-bottom: 5px;
  }
}
.post-body .tabs ul.nav-tabs li.tab {
  list-style-type: none !important;
  margin: 0 0.25em 0 0;
  border-top: 3px solid transparent;
  border-left: 1px solid transparent;
  border-right: 1px solid transparent;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab {
    margin: initial;
    border-top: 1px solid transparent;
    border-left: 3px solid transparent;
    border-right: 1px solid transparent;
    border-bottom: 1px solid transparent;
  }
}
.post-body .tabs ul.nav-tabs li.tab a {
  outline: 0;
  border-bottom: initial;
  display: block;
  line-height: 1.8em;
  padding: 0.25em 0.75em;
  transition-duration: 0.2s;
  transition-timing-function: ease-out;
  transition-delay: 0s;
}
.post-body .tabs ul.nav-tabs li.tab a i {
  width: 1.285714285714286em;
}
.post-body .tabs ul.nav-tabs li.tab.active {
  border-top: 3px solid #fc6423;
  border-left: 1px solid #ddd;
  border-right: 1px solid #ddd;
  background-color: #fff;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab.active {
    border-top: 1px solid #ddd;
    border-left: 3px solid #fc6423;
    border-right: 1px solid #ddd;
    border-bottom: 1px solid #ddd;
  }
}
.post-body .tabs ul.nav-tabs li.tab.active a {
  cursor: default;
  color: #555;
}
.post-body .tabs .tab-content {
  background-color: #fff;
}
.post-body .tabs .tab-content .tab-pane {
  border: 1px solid #ddd;
  padding: 20px 20px 0 20px;
}
.post-body .tabs .tab-content .tab-pane:not(.active) {
  display: none !important;
}
.post-body .tabs .tab-content .tab-pane.active {
  display: block !important;
}
.btn {
  display: inline-block;
  padding: 0 20px;
  font-size: 14px;
  color: #555;
  background: #fff;
  border: 2px solid #555;
  text-decoration: none;
  border-radius: 2px;
  transition-property: background-color;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
  line-height: 2;
}
.btn:hover {
  border-color: #222;
  color: #fff;
  background: #222;
}
.btn +.btn {
  margin: 0 0 8px 8px;
}
.btn .fa-fw {
  width: 1.285714285714286em;
  text-align: left;
}
.btn-bar {
  display: block;
  width: 22px;
  height: 2px;
  background: #555;
  border-radius: 1px;
}
.btn-bar+.btn-bar {
  margin-top: 4px;
}
.pagination {
  margin: 120px 0 40px;
  text-align: center;
  border-top: 1px solid #eee;
}
.page-number-basic,
.pagination .prev,
.pagination .next,
.pagination .page-number,
.pagination .space {
  display: inline-block;
  position: relative;
  top: -1px;
  margin: 0 10px;
  padding: 0 11px;
}
@media (max-width: 767px) {
  .page-number-basic,
  .pagination .prev,
  .pagination .next,
  .pagination .page-number,
  .pagination .space {
    margin: 0 5px;
  }
}
.pagination .prev,
.pagination .next,
.pagination .page-number {
  border-bottom: 0;
  border-top: 1px solid #eee;
  transition-property: border-color;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
}
.pagination .prev:hover,
.pagination .next:hover,
.pagination .page-number:hover {
  border-top-color: #222;
}
.pagination .space {
  padding: 0;
  margin: 0;
}
.pagination .prev {
  margin-left: 0;
}
.pagination .next {
  margin-right: 0;
}
.pagination .page-number.current {
  color: #fff;
  background: #ccc;
  border-top-color: #ccc;
}
@media (max-width: 767px) {
  .pagination {
    border-top: none;
  }
  .pagination .prev,
  .pagination .next,
  .pagination .page-number {
    margin-bottom: 10px;
    border-top: 0;
    border-bottom: 1px solid #eee;
    padding: 0 10px;
  }
  .pagination .prev:hover,
  .pagination .next:hover,
  .pagination .page-number:hover {
    border-bottom-color: #222;
  }
}
.comments {
  margin: 60px 20px 0;
}
.tag-cloud {
  text-align: center;
}
.tag-cloud a {
  display: inline-block;
  margin: 10px;
}
.back-to-top {
  box-sizing: border-box;
  position: fixed;
  bottom: -100px;
  right: 30px;
  z-index: 1050;
  padding: 0 6px;
  width: initial;
  background: #222;
  font-size: 12px;
  opacity: 0.6;
  color: #fff;
  cursor: pointer;
  text-align: center;
  -webkit-transform: translateZ(0);
  transition-property: bottom;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
}
@media (min-width: 768px) and (max-width: 991px) {
  .back-to-top {
    display: none !important;
  }
}
@media (max-width: 767px) {
  .back-to-top {
    display: none !important;
  }
}
.back-to-top.back-to-top-on {
  bottom: 30px;
}
.header {
  background: transparent;
}
.header-inner {
  position: relative;
}
.headband {
  height: 3px;
  background: #222;
}
.site-meta {
  margin: 0;
  text-align: center;
}
@media (max-width: 767px) {
  .site-meta {
    text-align: center;
  }
}
.brand {
  position: relative;
  display: inline-block;
  padding: 0 40px;
  color: #fff;
  background: #222;
  border-bottom: none;
}
.brand:hover {
  color: #fff;
}
.logo {
  display: inline-block;
  margin-right: 5px;
  line-height: 36px;
  vertical-align: top;
}
.site-title {
  display: inline-block;
  vertical-align: top;
  line-height: 36px;
  font-size: 20px;
  font-weight: normal;
  font-family: 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif;
}
.site-subtitle {
  margin-top: 10px;
  font-size: 13px;
  color: #ddd;
}
.use-motion .brand {
  opacity: 0;
}
.use-motion .logo,
.use-motion .site-title,
.use-motion .site-subtitle {
  opacity: 0;
  position: relative;
  top: -10px;
}
.site-nav-toggle {
  display: none;
  position: absolute;
  top: 10px;
  left: 10px;
}
@media (max-width: 767px) {
  .site-nav-toggle {
    display: block;
  }
}
.site-nav-toggle button {
  margin-top: 2px;
  padding: 9px 10px;
  background: transparent;
  border: none;
}
@media (max-width: 767px) {
  .site-nav {
    display: none;
    margin: 0 -10px;
    padding: 0 10px;
    clear: both;
    border-top: 1px solid #ddd;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav {
    display: block !important;
  }
}
@media (min-width: 992px) {
  .site-nav {
    display: block !important;
  }
}
.menu {
  margin-top: 20px;
  padding-left: 0;
  text-align: center;
}
.menu .menu-item {
  display: inline-block;
  margin: 0 10px;
  list-style: none;
}
@media screen and (max-width: 767px) {
  .menu .menu-item {
    margin-top: 10px;
  }
}
.menu .menu-item a {
  display: block;
  font-size: 13px;
  line-height: inherit;
  border-bottom: 1px solid transparent;
  transition-property: border-color;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
}
.menu .menu-item a:hover,
.menu-item-active a {
  border-bottom-color: #222;
}
.menu .menu-item .fa {
  margin-right: 5px;
}
.use-motion .menu-item {
  opacity: 0;
}
.post-body {
  font-family: 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif;
}
@media (max-width: 767px) {
  .post-body {
    word-break: break-word;
  }
}
.post-body .fancybox img {
  display: block !important;
  margin: 0 auto;
  cursor: pointer;
  cursor: zoom-in;
  cursor: -webkit-zoom-in;
}
.post-body .image-caption,
.post-body .figure .caption {
  margin: -20px auto 15px;
  text-align: center;
  font-size: 14px;
  color: #999;
  font-weight: bold;
  line-height: 1;
}
.post-sticky-flag {
  display: inline-block;
  font-size: 16px;
  -ms-transform: rotate(30deg);
  -webkit-transform: rotate(30deg);
  -moz-transform: rotate(30deg);
  -ms-transform: rotate(30deg);
  -o-transform: rotate(30deg);
  transform: rotate(30deg);
}
.use-motion .post-block,
.use-motion .pagination,
.use-motion .comments {
  opacity: 0;
}
.use-motion .post-header {
  opacity: 0;
}
.use-motion .post-body {
  opacity: 0;
}
.use-motion .collection-title {
  opacity: 0;
}
.posts-expand {
  padding-top: 40px;
}
@media (max-width: 767px) {
  .posts-expand {
    margin: 0 20px;
  }
  .post-body pre .gutter pre {
    padding-right: 10px;
  }
  .post-body .highlight {
    margin-left: 0px;
    margin-right: 0px;
    padding: 0;
  }
  .post-body .highlight .gutter pre {
    padding-right: 10px;
  }
}
@media (min-width: 992px) {
  .posts-expand .post-body {
    text-align: justify;
  }
}
.posts-expand .post-body h2,
.posts-expand .post-body h3,
.posts-expand .post-body h4,
.posts-expand .post-body h5,
.posts-expand .post-body h6 {
  padding-top: 10px;
}
.posts-expand .post-body h2 .header-anchor,
.posts-expand .post-body h3 .header-anchor,
.posts-expand .post-body h4 .header-anchor,
.posts-expand .post-body h5 .header-anchor,
.posts-expand .post-body h6 .header-anchor {
  float: right;
  margin-left: 10px;
  color: #ccc;
  border-bottom-style: none;
  visibility: hidden;
}
.posts-expand .post-body h2 .header-anchor:hover,
.posts-expand .post-body h3 .header-anchor:hover,
.posts-expand .post-body h4 .header-anchor:hover,
.posts-expand .post-body h5 .header-anchor:hover,
.posts-expand .post-body h6 .header-anchor:hover {
  color: inherit;
}
.posts-expand .post-body h2:hover .header-anchor,
.posts-expand .post-body h3:hover .header-anchor,
.posts-expand .post-body h4:hover .header-anchor,
.posts-expand .post-body h5:hover .header-anchor,
.posts-expand .post-body h6:hover .header-anchor {
  visibility: visible;
}
.posts-expand .post-body ul li {
  list-style: circle;
}
.posts-expand .post-body img {
  box-sizing: border-box;
  margin: auto;
  padding: 3px;
  border: 1px solid #ddd;
}
.posts-expand .post-body .fancybox img {
  margin: 0 auto 25px;
}
.posts-expand .post-body img {
  margin: 0 auto 25px;
}
@media (max-width: 767px) {
  .posts-collapse {
    margin: 0 20px;
  }
  .posts-collapse .post-title,
  .posts-collapse .post-meta {
    display: block;
    width: auto;
    text-align: left;
  }
}
.posts-collapse {
  position: relative;
  z-index: 1010;
  margin-left: 55px;
}
.posts-collapse::after {
  content: " ";
  position: absolute;
  top: 20px;
  left: 0;
  margin-left: -2px;
  width: 4px;
  height: 100%;
  background: #f5f5f5;
  z-index: -1;
}
@media (max-width: 767px) {
  .posts-collapse {
    margin: 0 20px;
  }
}
.posts-collapse .collection-title {
  position: relative;
  margin: 60px 0;
}
.posts-collapse .collection-title h1,
.posts-collapse .collection-title h2 {
  margin-left: 20px;
}
.posts-collapse .collection-title small {
  color: #bbb;
  margin-left: 5px;
}
.posts-collapse .collection-title::before {
  content: " ";
  position: absolute;
  left: 0;
  top: 50%;
  margin-left: -4px;
  margin-top: -4px;
  width: 8px;
  height: 8px;
  background: #bbb;
  border-radius: 50%;
}
.posts-collapse .post {
  margin: 30px 0;
}
.posts-collapse .post-header {
  position: relative;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
  transition-property: border;
  border-bottom: 1px dashed #ccc;
}
.posts-collapse .post-header::before {
  content: " ";
  position: absolute;
  left: 0;
  top: 12px;
  width: 6px;
  height: 6px;
  margin-left: -4px;
  background: #bbb;
  border-radius: 50%;
  border: 1px solid #fff;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
  transition-property: background;
}
.posts-collapse .post-header:hover {
  border-bottom-color: #666;
}
.posts-collapse .post-header:hover::before {
  background: #222;
}
.posts-collapse .post-meta {
  position: absolute;
  font-size: 12px;
  left: 20px;
  top: 5px;
}
.posts-collapse .post-comments-count {
  display: none;
}
.posts-collapse .post-title {
  margin-left: 60px;
  font-size: 16px;
  font-weight: normal;
  line-height: inherit;
}
.posts-collapse .post-title::after {
  margin-left: 3px;
  opacity: 0.6;
}
.posts-collapse .post-title a {
  color: #666;
  border-bottom: none;
}
.page-home .post-type-quote .post-header,
.page-post-detail .post-type-quote .post-header,
.page-home .post-type-quote .post-tags,
.page-post-detail .post-type-quote .post-tags {
  display: none;
}
.posts-expand .post-title {
  text-align: center;
  word-break: break-word;
  font-weight: 400;
}
.posts-expand .post-title-link {
  display: inline-block;
  position: relative;
  color: #555;
  border-bottom: none;
  line-height: 1.2;
  vertical-align: top;
}
.posts-expand .post-title-link::before {
  content: "";
  position: absolute;
  width: 100%;
  height: 2px;
  bottom: 0;
  left: 0;
  background-color: #000;
  visibility: hidden;
  -webkit-transform: scaleX(0);
  -moz-transform: scaleX(0);
  -ms-transform: scaleX(0);
  -o-transform: scaleX(0);
  transform: scaleX(0);
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
}
.posts-expand .post-title-link:hover::before {
  visibility: visible;
  -webkit-transform: scaleX(1);
  -moz-transform: scaleX(1);
  -ms-transform: scaleX(1);
  -o-transform: scaleX(1);
  transform: scaleX(1);
}
.posts-expand .post-title-link .fa {
  font-size: 16px;
}
.posts-expand .post-meta {
  margin: 3px 0 60px 0;
  color: #999;
  font-family: 'Lato', "PingFang SC", "Microsoft YaHei", sans-serif;
  font-size: 12px;
  text-align: center;
}
.posts-expand .post-meta .post-category-list {
  display: inline-block;
  margin: 0;
  padding: 3px;
}
.posts-expand .post-meta .post-category-list-link {
  color: #999;
}
.posts-expand .post-meta .post-description {
  font-size: 14px;
  margin-top: 2px;
}
.posts-expand .post-meta time {
  border-bottom: 1px dashed #999;
  cursor: help;
}
.post-meta-divider {
  margin: 0 0.5em;
}
.post-meta-item-icon {
  margin-right: 3px;
}
@media (min-width: 768px) and (max-width: 991px) {
  .post-meta-item-icon {
    display: inline-block;
  }
}
@media (max-width: 767px) {
  .post-meta-item-icon {
    display: inline-block;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  .post-meta-item-text {
    display: none;
  }
}
@media (max-width: 767px) {
  .post-meta-item-text {
    display: none;
  }
}
.post-button {
  margin-top: 40px;
}
.posts-expand .post-tags {
  margin-top: 40px;
  text-align: center;
}
.posts-expand .post-tags a {
  display: inline-block;
  margin-right: 10px;
  font-size: 13px;
}
.post-nav {
  display: table;
  margin-top: 15px;
  width: 100%;
  border-top: 1px solid #eee;
}
.post-nav-divider {
  display: table-cell;
  width: 10%;
}
.post-nav-item {
  display: table-cell;
  padding: 10px 0 0 0;
  width: 45%;
  vertical-align: top;
}
.post-nav-item a {
  position: relative;
  display: block;
  line-height: 25px;
  font-size: 14px;
  color: #555;
  border-bottom: none;
}
.post-nav-item a:hover {
  color: #222;
  border-bottom: none;
}
.post-nav-item a:active {
  top: 2px;
}
.post-nav-item .fa {
  position: absolute;
  top: 8px;
  left: 0;
  font-size: 12px;
}
.post-nav-next a {
  padding-left: 15px;
}
.post-nav-prev {
  text-align: right;
}
.post-nav-prev a {
  padding-right: 15px;
}
.post-nav-prev .fa {
  right: 0;
  left: auto;
}
.posts-expand .post-eof {
  display: block;
  margin: 80px auto 60px;
  width: 8%;
  height: 1px;
  background: #ccc;
  text-align: center;
}
.post:last-child .post-eof.post-eof.post-eof {
  display: none;
}
.post-gallery {
  display: table;
  table-layout: fixed;
  width: 100%;
  border-collapse: separate;
}
.post-gallery-row {
  display: table-row;
}
.post-gallery .post-gallery-img {
  display: table-cell;
  text-align: center;
  vertical-align: middle;
  border: none;
}
.post-gallery .post-gallery-img img {
  max-width: 100%;
  max-height: 100%;
  border: none;
}
.fancybox-close,
.fancybox-close:hover {
  border: none;
}
.post-copyright {
  margin: 2em 0 0;
  padding: 0.5em 1em;
  border-left: 3px solid #ff1700;
  background-color: #f9f9f9;
  list-style: none;
}
.rtl.post-body p,
.rtl.post-body a,
.rtl.post-body h1,
.rtl.post-body h2,
.rtl.post-body h3,
.rtl.post-body h4,
.rtl.post-body h5,
.rtl.post-body h6,
.rtl.post-body li,
.rtl.post-body ul,
.rtl.post-body ol {
  direction: rtl;
  font-family: UKIJ Ekran;
}
.rtl.post-title {
  font-family: UKIJ Ekran;
}
.sidebar {
  position: fixed;
  right: 0;
  top: 0;
  bottom: 0;
  width: 0;
  z-index: 1040;
  box-shadow: inset 0 2px 6px #000;
  background: #222;
  -webkit-transform: translateZ(0);
}
.sidebar a,
.sidebar .exturl {
  color: #999;
  border-bottom-color: #555;
}
.sidebar a:hover,
.sidebar .exturl:hover {
  color: #eee;
}
@media (min-width: 768px) and (max-width: 991px) {
  .sidebar {
    display: none !important;
  }
}
@media (max-width: 767px) {
  .sidebar {
    display: none !important;
  }
}
.sidebar-inner {
  position: relative;
  padding: 20px 10px;
  color: #999;
  text-align: center;
}
.site-overview-wrap {
  overflow: hidden;
}
.site-overview {
  overflow-y: auto;
  overflow-x: hidden;
}
.sidebar-toggle {
  position: fixed;
  right: 30px;
  bottom: 45px;
  width: 14px;
  height: 14px;
  padding: 5px;
  background: #222;
  line-height: 0;
  z-index: 1050;
  cursor: pointer;
  -webkit-transform: translateZ(0);
}
@media (min-width: 768px) and (max-width: 991px) {
  .sidebar-toggle {
    display: none !important;
  }
}
@media (max-width: 767px) {
  .sidebar-toggle {
    display: none !important;
  }
}
.sidebar-toggle-line {
  position: relative;
  display: inline-block;
  vertical-align: top;
  height: 2px;
  width: 100%;
  background: #fff;
  margin-top: 3px;
}
.sidebar-toggle-line:first-child {
  margin-top: 0;
}
.site-author-image {
  display: block;
  margin: 0 auto;
  padding: 2px;
  max-width: 120px;
  height: auto;
  border: 1px solid #eee;
  opacity: 1;
}
.site-author-image {
  border-radius: 100%;
}
.site-author-image {
  -webkit-transition: -webkit-transform 1s ease-out;
  -moz-transition: -moz-transform 1s ease-out;
  -ms-transition: -ms-transform 1s ease-out;
  transition: transform 1s ease-out;
}
.site-author-image:hover {
  -webkit-transform: rotateZ(360deg);
  -moz-transform: rotateZ(360deg);
  -ms-transform: rotate(360deg);
  -webkit-transform: rotateZ(360deg);
  -moz-transform: rotateZ(360deg);
  -ms-transform: rotateZ(360deg);
  -o-transform: rotateZ(360deg);
  transform: rotateZ(360deg);
}
.site-author-name {
  margin: 0;
  text-align: center;
  color: #222;
  font-weight: 600;
}
.site-description {
  margin-top: 0;
  text-align: center;
  font-size: 13px;
  color: #999;
}
.site-state {
  overflow: hidden;
  line-height: 1.4;
  white-space: nowrap;
  text-align: center;
}
.site-state-item {
  display: inline-block;
  padding: 0 15px;
  border-left: 1px solid #eee;
}
.site-state-item:first-child {
  border-left: none;
}
.site-state-item a {
  border-bottom: none;
}
.site-state-item-count {
  display: block;
  text-align: center;
  color: inherit;
  font-weight: 600;
  font-size: 16px;
}
.site-state-item-name {
  font-size: 13px;
  color: #999;
}
.feed-link {
  margin-top: 20px;
}
.feed-link a {
  display: inline-block;
  padding: 0 15px;
  color: #fc6423;
  border: 1px solid #fc6423;
  border-radius: 4px;
}
.feed-link a i {
  color: #fc6423;
  font-size: 14px;
}
.feed-link a:hover {
  color: #fff;
  background: #fc6423;
}
.feed-link a:hover i {
  color: #fff;
}
.links-of-author {
  margin-top: 20px;
}
.links-of-author a,
.links-of-author .exturl {
  display: inline-block;
  vertical-align: middle;
  margin-right: 10px;
  margin-bottom: 10px;
  border-bottom-color: #555;
  font-size: 13px;
}
.links-of-author a:before,
.links-of-author .exturl:before {
  display: inline-block;
  vertical-align: middle;
  margin-right: 3px;
  content: " ";
  width: 4px;
  height: 4px;
  border-radius: 50%;
  background: #9cff1b;
}
.links-of-blogroll {
  font-size: 13px;
}
.links-of-blogroll-title {
  margin-top: 20px;
  font-size: 14px;
  font-weight: 600;
}
.links-of-blogroll-list {
  margin: 0;
  padding: 0;
  list-style: none;
}
.links-of-blogroll-item {
  padding: 2px 10px;
}
.links-of-blogroll-item a {
  max-width: 280px;
  box-sizing: border-box;
  display: inline-block;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}
.sidebar-nav {
  margin: 0 0 20px;
  padding-left: 0;
}
.sidebar-nav li {
  display: inline-block;
  cursor: pointer;
  border-bottom: 1px solid transparent;
  font-size: 14px;
  color: #555;
}
.sidebar-nav li:hover {
  color: #fc6423;
}
.page-post-detail .sidebar-nav-toc {
  padding: 0 5px;
}
.page-post-detail .sidebar-nav-overview {
  margin-left: 10px;
}
.sidebar-nav .sidebar-nav-active {
  color: #fc6423;
  border-bottom-color: #fc6423;
}
.sidebar-nav .sidebar-nav-active:hover {
  color: #fc6423;
}
.sidebar-panel {
  display: none;
}
.sidebar-panel-active {
  display: block;
}
.post-toc-empty {
  font-size: 14px;
  color: #666;
}
.post-toc-wrap {
  overflow: hidden;
}
.post-toc {
  overflow: auto;
}
.post-toc ol {
  margin: 0;
  padding: 0 2px 5px 10px;
  text-align: left;
  list-style: none;
  font-size: 14px;
}
.post-toc ol > ol {
  padding-left: 0;
}
.post-toc ol a {
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
  transition-property: all;
  color: #666;
  border-bottom-color: #ccc;
}
.post-toc ol a:hover {
  color: #000;
  border-bottom-color: #000;
}
.post-toc .nav-item {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  line-height: 1.8;
}
.post-toc .nav .nav-child {
  display: none;
}
.post-toc .nav .active > .nav-child {
  display: block;
}
.post-toc .nav .active-current > .nav-child {
  display: block;
}
.post-toc .nav .active-current > .nav-child > .nav-item {
  display: block;
}
.post-toc .nav .active > a {
  color: #fc6423;
  border-bottom-color: #fc6423;
}
.post-toc .nav .active-current > a {
  color: #fc6423;
}
.post-toc .nav .active-current > a:hover {
  color: #fc6423;
}
.footer {
  font-size: 14px;
  color: #999;
}
.footer img {
  border: none;
}
.footer-inner {
  text-align: center;
}
.with-love {
  display: inline-block;
  margin: 0 5px;
  color: #808080;
}
.powered-by,
.theme-info {
  display: inline-block;
}
.cc-license {
  margin-top: 10px;
  text-align: center;
}
.cc-license .cc-opacity {
  opacity: 0.7;
  border-bottom: none;
}
.cc-license .cc-opacity:hover {
  opacity: 0.9;
}
.cc-license img {
  display: inline-block;
}
@-moz-keyframes iconAnimate {
  0%, 100% {
    -webkit-transform: scale(1);
    -moz-transform: scale(1);
    -ms-transform: scale(1);
    -o-transform: scale(1);
    transform: scale(1);
  }
  10%, 30% {
    -webkit-transform: scale(0.9);
    -moz-transform: scale(0.9);
    -ms-transform: scale(0.9);
    -o-transform: scale(0.9);
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    -webkit-transform: scale(1.1);
    -moz-transform: scale(1.1);
    -ms-transform: scale(1.1);
    -o-transform: scale(1.1);
    transform: scale(1.1);
  }
  50%, 70% {
    -webkit-transform: scale(1.1);
    -moz-transform: scale(1.1);
    -ms-transform: scale(1.1);
    -o-transform: scale(1.1);
    transform: scale(1.1);
  }
}
@-webkit-keyframes iconAnimate {
  0%, 100% {
    -webkit-transform: scale(1);
    -moz-transform: scale(1);
    -ms-transform: scale(1);
    -o-transform: scale(1);
    transform: scale(1);
  }
  10%, 30% {
    -webkit-transform: scale(0.9);
    -moz-transform: scale(0.9);
    -ms-transform: scale(0.9);
    -o-transform: scale(0.9);
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    -webkit-transform: scale(1.1);
    -moz-transform: scale(1.1);
    -ms-transform: scale(1.1);
    -o-transform: scale(1.1);
    transform: scale(1.1);
  }
  50%, 70% {
    -webkit-transform: scale(1.1);
    -moz-transform: scale(1.1);
    -ms-transform: scale(1.1);
    -o-transform: scale(1.1);
    transform: scale(1.1);
  }
}
@-o-keyframes iconAnimate {
  0%, 100% {
    -webkit-transform: scale(1);
    -moz-transform: scale(1);
    -ms-transform: scale(1);
    -o-transform: scale(1);
    transform: scale(1);
  }
  10%, 30% {
    -webkit-transform: scale(0.9);
    -moz-transform: scale(0.9);
    -ms-transform: scale(0.9);
    -o-transform: scale(0.9);
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    -webkit-transform: scale(1.1);
    -moz-transform: scale(1.1);
    -ms-transform: scale(1.1);
    -o-transform: scale(1.1);
    transform: scale(1.1);
  }
  50%, 70% {
    -webkit-transform: scale(1.1);
    -moz-transform: scale(1.1);
    -ms-transform: scale(1.1);
    -o-transform: scale(1.1);
    transform: scale(1.1);
  }
}
@keyframes iconAnimate {
  0%, 100% {
    -webkit-transform: scale(1);
    -moz-transform: scale(1);
    -ms-transform: scale(1);
    -o-transform: scale(1);
    transform: scale(1);
  }
  10%, 30% {
    -webkit-transform: scale(0.9);
    -moz-transform: scale(0.9);
    -ms-transform: scale(0.9);
    -o-transform: scale(0.9);
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    -webkit-transform: scale(1.1);
    -moz-transform: scale(1.1);
    -ms-transform: scale(1.1);
    -o-transform: scale(1.1);
    transform: scale(1.1);
  }
  50%, 70% {
    -webkit-transform: scale(1.1);
    -moz-transform: scale(1.1);
    -ms-transform: scale(1.1);
    -o-transform: scale(1.1);
    transform: scale(1.1);
  }
}
.fa {
  font-family: FontAwesome !important;
}
.local-search-pop-overlay {
  position: fixed;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  z-index: 2080;
  background-color: rgba(0,0,0,0.3);
}
.local-search-popup {
  display: none;
  position: fixed;
  top: 10%;
  left: 50%;
  margin-left: -350px;
  width: 700px;
  height: 80%;
  padding: 0;
  background: #fff;
  color: #333;
  z-index: 9999;
  border-radius: 5px;
}
@media (max-width: 767px) {
  .local-search-popup {
    padding: 0;
    top: 0;
    left: 0;
    margin: 0;
    width: 100%;
    height: 100%;
    border-radius: 0;
  }
}
.local-search-popup ul.search-result-list {
  padding: 0;
  margin: 0 5px;
}
.local-search-popup p.search-result {
  border-bottom: 1px dashed #ccc;
  padding: 5px 0;
}
.local-search-popup a.search-result-title {
  font-weight: bold;
  font-size: 16px;
}
.local-search-popup .search-keyword {
  border-bottom: 1px dashed #f00;
  font-weight: bold;
  color: #f00;
}
.local-search-popup .local-search-header {
  padding: 5px;
  height: 36px;
  background: #f5f5f5;
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
}
.local-search-popup #local-search-result {
  overflow: auto;
  position: relative;
  padding: 5px 25px;
  height: calc(100% - 55px);
}
.local-search-popup .local-search-input-wrapper {
  display: inline-block;
  width: calc(100% - 90px);
  height: 36px;
  line-height: 36px;
  padding: 0 5px;
}
.local-search-popup .local-search-input-wrapper input {
  padding: 8px 0;
  height: 20px;
  display: block;
  width: 100%;
  outline: none;
  border: none;
  background: transparent;
  vertical-align: middle;
}
.local-search-popup .search-icon,
.local-search-popup .popup-btn-close {
  display: inline-block;
  font-size: 18px;
  color: #999;
  height: 36px;
  width: 18px;
  padding-left: 10px;
  padding-right: 10px;
}
.local-search-popup .search-icon {
  float: left;
}
.local-search-popup .popup-btn-close {
  border-left: 1px solid #eee;
  float: right;
  cursor: pointer;
}
.local-search-popup #no-result {
  position: absolute;
  left: 50%;
  top: 50%;
  -webkit-transform: translate(-50%, -50%);
  -webkit-transform: translate(-50%, -50%);
  -moz-transform: translate(-50%, -50%);
  -ms-transform: translate(-50%, -50%);
  -o-transform: translate(-50%, -50%);
  transform: translate(-50%, -50%);
  color: #ccc;
}
@media (min-width: 768px) and (max-width: 991px) {
  .busuanzi-count {
    width: auto;
  }
}
@media (max-width: 767px) {
  .busuanzi-count {
    width: auto;
  }
}
.site-uv,
.site-pv,
.page-pv {
  display: inline-block;
}
.site-uv .busuanzi-value,
.site-pv .busuanzi-value,
.page-pv .busuanzi-value {
  margin: 0 5px;
}
.page-archive .archive-page-counter {
  position: relative;
  top: 3px;
  left: 20px;
}
@media (max-width: 767px) {
  .page-archive .archive-page-counter {
    top: 5px;
  }
}
.page-archive .posts-collapse .archive-move-on {
  position: absolute;
  top: 11px;
  left: 0;
  margin-left: -6px;
  width: 10px;
  height: 10px;
  opacity: 0.5;
  background: #555;
  border: 1px solid #fff;
  border-radius: 50%;
}
.category-all-page .category-all-title {
  text-align: center;
}
.category-all-page .category-all {
  margin-top: 20px;
}
.category-all-page .category-list {
  margin: 0;
  padding: 0;
  list-style: none;
}
.category-all-page .category-list-item {
  margin: 5px 10px;
}
.category-all-page .category-list-count {
  color: #bbb;
}
.category-all-page .category-list-count:before {
  display: inline;
  content: " (";
}
.category-all-page .category-list-count:after {
  display: inline;
  content: ") ";
}
.category-all-page .category-list-child {
  padding-left: 10px;
}
#schedule ul#event-list {
  padding-left: 30px;
}
#schedule ul#event-list hr {
  margin: 20px 0 45px 0 !important;
  background: #222;
}
#schedule ul#event-list hr:after {
  display: inline-block;
  content: 'NOW';
  background: #222;
  color: #fff;
  font-weight: bold;
  text-align: right;
  padding: 0 5px;
}
#schedule ul#event-list li.event {
  margin: 20px 0px;
  background: #f9f9f9;
  padding-left: 10px;
  min-height: 40px;
}
#schedule ul#event-list li.event h2.event-summary {
  margin: 0;
  padding-bottom: 3px;
}
#schedule ul#event-list li.event h2.event-summary:before {
  display: inline-block;
  font-family: FontAwesome;
  font-size: 8px;
  content: '\f111';
  vertical-align: middle;
  margin-right: 25px;
  color: #bbb;
}
#schedule ul#event-list li.event span.event-relative-time {
  display: inline-block;
  font-size: 12px;
  font-weight: 400;
  padding-left: 12px;
  color: #bbb;
}
#schedule ul#event-list li.event span.event-details {
  display: block;
  color: #bbb;
  margin-left: 56px;
  padding-top: 3px;
  padding-bottom: 6px;
  text-indent: -24px;
  line-height: 18px;
}
#schedule ul#event-list li.event span.event-details:before {
  text-indent: 0;
  display: inline-block;
  width: 14px;
  font-family: FontAwesome;
  text-align: center;
  margin-right: 9px;
  color: #bbb;
}
#schedule ul#event-list li.event span.event-details.event-location:before {
  content: '\f041';
}
#schedule ul#event-list li.event span.event-details.event-duration:before {
  content: '\f017';
}
#schedule ul#event-list li.event-past {
  background: #fcfcfc;
}
#schedule ul#event-list li.event-past > * {
  opacity: 0.6;
}
#schedule ul#event-list li.event-past h2.event-summary {
  color: #bbb;
}
#schedule ul#event-list li.event-past h2.event-summary:before {
  color: #dfdfdf;
}
#schedule ul#event-list li.event-now {
  background: #222;
  color: #fff;
  padding: 15px 0 15px 10px;
}
#schedule ul#event-list li.event-now h2.event-summary:before {
  -webkit-transform: scale(1.2);
  -moz-transform: scale(1.2);
  -ms-transform: scale(1.2);
  -o-transform: scale(1.2);
  transform: scale(1.2);
  color: #fff;
  animation: dot-flash 1s alternate infinite ease-in-out;
}
#schedule ul#event-list li.event-now * {
  color: #fff !important;
}
@-moz-keyframes dot-flash {
  from {
    opacity: 1;
    -webkit-transform: scale(1.1);
    -moz-transform: scale(1.1);
    -ms-transform: scale(1.1);
    -o-transform: scale(1.1);
    transform: scale(1.1);
  }
  to {
    opacity: 0;
    -webkit-transform: scale(1);
    -moz-transform: scale(1);
    -ms-transform: scale(1);
    -o-transform: scale(1);
    transform: scale(1);
  }
}
@-webkit-keyframes dot-flash {
  from {
    opacity: 1;
    -webkit-transform: scale(1.1);
    -moz-transform: scale(1.1);
    -ms-transform: scale(1.1);
    -o-transform: scale(1.1);
    transform: scale(1.1);
  }
  to {
    opacity: 0;
    -webkit-transform: scale(1);
    -moz-transform: scale(1);
    -ms-transform: scale(1);
    -o-transform: scale(1);
    transform: scale(1);
  }
}
@-o-keyframes dot-flash {
  from {
    opacity: 1;
    -webkit-transform: scale(1.1);
    -moz-transform: scale(1.1);
    -ms-transform: scale(1.1);
    -o-transform: scale(1.1);
    transform: scale(1.1);
  }
  to {
    opacity: 0;
    -webkit-transform: scale(1);
    -moz-transform: scale(1);
    -ms-transform: scale(1);
    -o-transform: scale(1);
    transform: scale(1);
  }
}
@keyframes dot-flash {
  from {
    opacity: 1;
    -webkit-transform: scale(1.1);
    -moz-transform: scale(1.1);
    -ms-transform: scale(1.1);
    -o-transform: scale(1.1);
    transform: scale(1.1);
  }
  to {
    opacity: 0;
    -webkit-transform: scale(1);
    -moz-transform: scale(1);
    -ms-transform: scale(1);
    -o-transform: scale(1);
    transform: scale(1);
  }
}
.page-post-detail .sidebar-toggle-line {
  background: #fc6423;
}
.page-post-detail .comments {
  overflow: hidden;
}
ul.breadcrumb {
  list-style: none;
  margin: 1em 0;
  padding: 0 2em;
  text-align: center;
  font-size: 12px;
}
ul.breadcrumb li {
  display: inline;
}
ul.breadcrumb li+li:before {
  padding: 0.5em;
  font-weight: normal;
  content: "/\00a0";
}
ul.breadcrumb li+li:last-child {
  font-weight: bold;
}
.header {
  position: relative;
  margin: 0 auto;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .header {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .header {
    width: 73%;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  .header {
    width: auto;
  }
}
@media (max-width: 767px) {
  .header {
    width: auto;
  }
}
.header-inner {
  position: absolute;
  top: 0;
  overflow: hidden;
  padding: 0;
  width: 240px;
  background: #fff;
  box-shadow: initial;
  border-radius: initial;
}
@media (min-width: 1200px) {
  .container .header-inner {
    width: 240px;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  .header-inner {
    position: relative;
    width: auto;
    border-radius: initial;
  }
}
@media (max-width: 767px) {
  .header-inner {
    position: relative;
    width: auto;
    border-radius: initial;
  }
}
.main:before,
.main:after {
  content: " ";
  display: table;
}
.main:after {
  clear: both;
}
@media (min-width: 768px) and (max-width: 991px) {
  .main {
    padding-bottom: 100px;
  }
}
@media (max-width: 767px) {
  .main {
    padding-bottom: 100px;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  .container .main-inner {
    width: auto;
  }
}
@media (max-width: 767px) {
  .container .main-inner {
    width: auto;
  }
}
.content-wrap {
  float: right;
  box-sizing: border-box;
  padding: 40px;
  width: calc(100% - 252px);
  background: #fff;
  min-height: 700px;
  box-shadow: initial;
  border-radius: initial;
}
@media (min-width: 768px) and (max-width: 991px) {
  .content-wrap {
    width: 100%;
    padding: 20px;
    border-radius: initial;
  }
}
@media (max-width: 767px) {
  .content-wrap {
    width: 100%;
    padding: 20px;
    min-height: auto;
    border-radius: initial;
  }
}
.sidebar {
  position: static;
  float: left;
  margin-top: 300px;
  width: 240px;
  background: #f5f7f9;
  box-shadow: none;
}
@media (min-width: 768px) and (max-width: 991px) {
  .sidebar {
    display: none;
  }
}
@media (max-width: 767px) {
  .sidebar {
    display: none;
  }
}
.sidebar-toggle {
  display: none;
}
.footer-inner {
  padding-left: 260px;
}
@media (min-width: 768px) and (max-width: 991px) {
  .footer-inner {
    width: auto;
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
}
@media (max-width: 767px) {
  .footer-inner {
    width: auto;
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
}
.sidebar-position-right .header-inner {
  right: 0;
}
.sidebar-position-right .content-wrap {
  float: left;
}
.sidebar-position-right .sidebar {
  float: right;
}
.sidebar-position-right .footer-inner {
  padding-left: 0;
  padding-right: 260px;
}
.site-brand-wrapper {
  position: relative;
}
.site-meta {
  padding: 20px 0;
  color: #fff;
  background: #222;
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-meta {
    box-shadow: 0 0 16px rgba(0,0,0,0.5);
  }
}
@media (max-width: 767px) {
  .site-meta {
    box-shadow: 0 0 16px rgba(0,0,0,0.5);
  }
}
.brand {
  padding: 0;
  background: none;
}
.brand:hover {
  color: #fff;
}
.site-subtitle {
  margin: 10px 10px 0;
  font-weight: initial;
}
.site-search form {
  display: none;
}
.site-nav {
  border-top: none;
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav {
    display: none !important;
  }
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav-on {
    display: block !important;
  }
}
.menu .menu-item {
  display: block;
  margin: 0;
}
.menu .menu-item a {
  position: relative;
  box-sizing: border-box;
  padding: 5px 20px;
  text-align: left;
  line-height: inherit;
  transition-property: background-color;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
  transition-delay: 0s;
}
.menu .menu-item a:hover,
.menu-item-active a {
  background: #f9f9f9;
  border-bottom-color: #fff;
}
.menu .menu-item .badge {
  display: inline-block;
  padding: 2px 5px;
  font-weight: 700;
  line-height: 1;
  color: #fff;
  text-align: center;
  white-space: nowrap;
  vertical-align: middle;
  background-color: #ccc;
  border-radius: 10px;
  float: right;
  margin: 0.35em 0 0 0;
  text-shadow: 1px 1px 0px rgba(0,0,0,0.1);
}
.menu .menu-item br {
  display: none;
}
.btn-bar {
  background-color: #fff;
}
.site-nav-toggle {
  left: 20px;
  top: 50%;
  -webkit-transform: translateY(-50%);
  -webkit-transform: translateY(-50%);
  -moz-transform: translateY(-50%);
  -ms-transform: translateY(-50%);
  -o-transform: translateY(-50%);
  transform: translateY(-50%);
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav-toggle {
    display: block;
  }
}
.sub-menu {
  margin: 0;
  padding: 6px 0;
  background: #fff !important;
  border-bottom: 1px solid #ddd;
}
.sub-menu .menu-item {
  display: inline-block !important;
}
.sub-menu .menu-item a {
  padding: initial !important;
  margin: 5px 10px;
}
.sub-menu .menu-item a:hover {
  background: initial !important;
  color: #fc6423;
}
.sub-menu .menu-item-active a {
  background: #fff !important;
  color: #fc6423;
  border-bottom-color: #fc6423;
}
.sub-menu .menu-item-active a:hover {
  background: #fff !important;
  border-bottom-color: #fc6423;
}
.use-motion .sidebar .motion-element {
  opacity: 1;
}
.sidebar {
  margin-left: -100%;
  right: auto;
  bottom: auto;
  -webkit-transform: none;
}
.sidebar-inner {
  box-sizing: border-box;
  width: 240px;
  color: #555;
  background: #fff;
  box-shadow: initial;
  border-radius: initial;
  opacity: 0;
}
.sidebar-inner.affix {
  position: fixed;
  top: 12px;
}
.sidebar-inner.affix-bottom {
  position: absolute;
}
.site-overview {
  text-align: left;
}
.site-author:before,
.site-author:after {
  content: " ";
  display: table;
}
.site-author:after {
  clear: both;
}
.sidebar a,
.sidebar .exturl {
  color: #555;
}
.sidebar a:hover,
.sidebar .exturl:hover {
  color: #222;
}
.site-state-item {
  padding: 0 10px;
}
.links-of-author-item a:before,
.links-of-author-item .exturl:before {
  display: none;
}
.links-of-author-item a,
.links-of-author-item .exturl {
  border-bottom: none;
  text-decoration: underline;
}
.feed-link {
  border-top: 1px dotted #ccc;
  border-bottom: 1px dotted #ccc;
  text-align: center;
}
.feed-link a {
  display: block;
  color: #fc6423;
  border: none;
}
.feed-link a:hover {
  background: none;
  color: #e34603;
}
.feed-link a:hover i {
  color: #e34603;
}
.links-of-author {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
}
.links-of-author .exturl {
  font-size: 13px;
}
.links-of-author-item {
  margin: 5px 0 0;
  width: 50%;
}
.links-of-author-item a,
.links-of-author-item .exturl {
  max-width: 216px;
  box-sizing: border-box;
  display: inline-block;
  margin-right: 0;
  margin-bottom: 0;
  padding: 0 5px;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}
.links-of-author-item a,
.links-of-author-item .exturl {
  display: block;
  text-decoration: none;
}
.links-of-author-item a:hover,
.links-of-author-item .exturl:hover {
  border-radius: 4px;
  background: #eee;
}
.links-of-author-item .fa {
  margin-right: 2px;
  font-size: 16px;
}
.links-of-author-item .fa-globe {
  font-size: 15px;
}
.links-of-blogroll {
  text-align: center;
  margin-top: 20px;
  padding: 3px 0 0;
  border-top: 1px dotted #ccc;
}
.links-of-blogroll-title {
  margin-top: 0;
}
.links-of-blogroll-item {
  padding: 0;
}
.links-of-blogroll-inline:before,
.links-of-blogroll-inline:after {
  content: " ";
  display: table;
}
.links-of-blogroll-inline:after {
  clear: both;
}
.links-of-blogroll-inline .links-of-blogroll-item {
  margin: 5px 0 0;
  width: 50%;
  display: inline-block;
  width: unset;
}
.links-of-blogroll-inline .links-of-blogroll-item a,
.links-of-blogroll-inline .links-of-blogroll-item .exturl {
  max-width: 216px;
  box-sizing: border-box;
  display: inline-block;
  margin-right: 0;
  margin-bottom: 0;
  padding: 0 5px;
  overflow: hidden;
  white-space: nowrap;
  text-overflow: ellipsis;
}
@media (max-width: 767px) {
  .post-body {
    text-align: justify;
  }
}
</style><noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

<script>function loadCss(l){var d=document,h=d.head,s=d.createElement('link');s.rel='stylesheet';s.href=l;!function e(f){if (d.body)return f();setTimeout(function(){e(f)})}(function(){h.appendChild(s);});}loadCss('/style.css');</script></head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">0x0</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <h1 class="site-subtitle" itemprop="description">从0开始，向另一个0结束，那么中间有没有1，有没有其他呢？哈哈哈哈。。。</h1>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">10</span></a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">20</span></a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">21</span></a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.q-moe.com/2020/07/11/GitLab-Jenkins-K8S-生产环境可CI-CD模拟/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Paul Li">
      <meta itemprop="description" content="学习，记录，分享">
      <meta itemprop="image" content="/images/avatar.jpeg">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="0x0">
    </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">GitLab+Jenkins+K8S (生产环境可 CI/CD 模拟)
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2020-07-11 18:43:31" itemprop="dateCreated datePublished" datetime="2020-07-11T18:43:31+08:00">2020-07-11</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2020-07-08 11:53:30" itemprop="dateModified" datetime="2020-07-08T11:53:30+08:00">2020-07-08</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/部署/" itemprop="url" rel="index"><span itemprop="name">部署</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2020/07/11/GitLab-Jenkins-K8S-生产环境可CI-CD模拟/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2020/07/11/GitLab-Jenkins-K8S-生产环境可CI-CD模拟/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2020/07/11/GitLab-Jenkins-K8S-生产环境可CI-CD模拟/" class="leancloud_visitors" data-flag-title="GitLab+Jenkins+K8S (生产环境可 CI/CD 模拟)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>该文档复制自 <a href="https://www.feiyiblog.com/2020/05/11/Docker-k8s-GitLab-Jenkins-%E7%94%9F%E6%88%90%E7%8E%AF%E5%A2%83%E5%8F%AFCI-CD%E6%A8%A1%E6%8B%9F/" target="_blank" rel="noopener">Docker+k8s+GitLab+Jenkins (生产环境可 CI/CD 模拟)</a></p>
<p>这个环境仅做参考</p>
<blockquote class="blockquote-center"><p>通过 Docker+k8s 来部署 web 集群，GitLab+Jenkins 实现代码自动化部署，在 Jenkins 中通过构建脚本，实现 k8s 对容器 web 集群代码自动更新</p>
</blockquote>
<h1 id="运行环境"><a href="#运行环境" class="headerlink" title="运行环境"></a>运行环境</h1><table>
<thead>
<tr>
<th style="text-align:left">ip</th>
<th style="text-align:left"> 服务</th>
<th style="text-align:left">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"> 192.168.1.1</td>
<td style="text-align:left">GitLab</td>
<td style="text-align:left"> 内存 4G，双核 CPU（CentOS7.8）</td>
</tr>
<tr>
<td style="text-align:left">192.168.1.4</td>
<td style="text-align:left">Jenkins</td>
<td style="text-align:left"> 内核 2G，双核 CPU（CentOS7.8）</td>
</tr>
<tr>
<td style="text-align:left">192.168.1.11</td>
<td style="text-align:left">Docker+k8s-master</td>
<td style="text-align:left"> 内核 2G，双核 CPU（CentOS7.8）</td>
</tr>
<tr>
<td style="text-align:left">192.168.1.12</td>
<td style="text-align:left">Docker+k8s-node1</td>
<td style="text-align:left"> 内核 2G，双核 CPU（CentOS7.8）</td>
</tr>
<tr>
<td style="text-align:left">192.168.1.13</td>
<td style="text-align:left">Docker+k8s-node2</td>
<td style="text-align:left"> 内核 2G，双核 CPU（CentOS7.8）</td>
</tr>
</tbody>
</table>
<a id="more"></a>
<h1 id="部署目的"><a href="#部署目的" class="headerlink" title="部署目的"></a>部署目的</h1><p>在开发进行代码的更新后，上传到 GitLab，Jenkins 根据 webhook 发现代码的更新后，进行代码构建和 k8s 中的自动部署，展现到 web 界面中</p>
<h1 id="搭建GitLab"><a href="#搭建GitLab" class="headerlink" title="搭建GitLab"></a>搭建 GitLab</h1><p>参考文档 <a href="https://www.feiyiblog.com/2020/03/06/Git版本控制/" target="_blank" rel="noopener">Git 搭建</a>和 <a href="https://www.feiyiblog.com/2020/03/07/GitLab在线代码仓库托管/" target="_blank" rel="noopener">GitLab 搭建</a></p>
<p>除了程序是通过 yum 安装的没有什么不同</p>
<h2 id="192-168-1-1"><a href="#192-168-1-1" class="headerlink" title="192.168.1.1"></a>192.168.1.1</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># hostnamectl set-hostname gitlab</span></span><br><span class="line">[root@localhost ~]<span class="comment"># bash</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># vim /etc/hosts</span></span><br><span class="line">192.168.1.1 gitlab</span><br><span class="line">192.168.1.4 jenkins</span><br></pre></td></tr></tbody></table></figure>
<p>开启路由转发</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># echo "net.ipv4.ip_forward = 1" &gt;&gt; /etc/sysctl.conf</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># sysctl -p</span></span><br><span class="line">net.ipv4.ip_forward = 1</span><br></pre></td></tr></tbody></table></figure>
<p>安装 Git</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># yum -y install git</span></span><br></pre></td></tr></tbody></table></figure>
<p>配置 GitLab 的 repo 源</p>
<p>使用清华大学的 repo 源</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># cat &lt;&lt;EOF&gt; /etc/yum.repos.d/gitlab-ce.repo</span></span><br><span class="line">[gitlab-ce]</span><br><span class="line">name=Gitlab CE Repository</span><br><span class="line">baseurl=https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">EOF</span><br></pre></td></tr></tbody></table></figure>
<p>安装 GitLab</p>
<p>使用 yum 安装的最新版本发现对密钥问题还有点不稳定</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># yum -y install gitlab-ce</span></span><br></pre></td></tr></tbody></table></figure>
<p>将 SELinux 设置为禁用，可解决设置 gitlab 公钥后不生效，而且还需要输入账号密码（这个问题我找了十多个小时😓）</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># setenforce 0</span></span><br><span class="line">[root@gitlab ~]<span class="comment"># sed -i 's/^SELINUX=enforcing$/SELINUX=disabled/' /etc/selinux/config</span></span><br></pre></td></tr></tbody></table></figure>
<p>生产环境中需要修改访问 GitLab 的域名或者 ip</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># vim /etc/gitlab/gitlab.rb</span></span><br><span class="line"><span class="comment"># 将external_url 'http://gitlab.example.com'</span></span><br><span class="line"><span class="comment"># 修改为external_url 'http://192.168.1.1'，本机域名或者ip</span></span><br></pre></td></tr></tbody></table></figure>
<p>初始化 GitLab</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># gitlab-ctl reconfigure   # 第一次需要很长时间</span></span><br></pre></td></tr></tbody></table></figure>
<p>启动 GitLab</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># gitlab-ctl start</span></span><br></pre></td></tr></tbody></table></figure>
<p>放行端口</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@gitlab ~]<span class="comment"># firewall-cmd --permanent --add-service=http</span></span><br><span class="line">success</span><br><span class="line">[root@gitlab ~]<span class="comment"># firewall-cmd --reload</span></span><br><span class="line">success</span><br></pre></td></tr></tbody></table></figure>
<p>登陆到 Web 管理界面设置的登录密码</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.1</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://www.feiyiblog.com/uploads/set_password.png" alt="GitLab"></p>
<p>默认用户为 root</p>
<p><img src="https://www.feiyiblog.com/uploads/first_login.png" alt="GitLab"></p>
<p>登录成功</p>
<p><img src="https://www.feiyiblog.com/uploads/gitlab_login.png" alt="img"></p>
<h1 id="搭建Jenkins"><a href="#搭建Jenkins" class="headerlink" title="搭建Jenkins"></a>搭建 Jenkins</h1><p>参考文档 <a href="https://www.feiyiblog.com/2020/03/10/Jenkins代码自动化/" target="_blank" rel="noopener">Jenkins 搭建</a></p>
<p>除了程序是通过 yum 安装的没有什么不同</p>
<h2 id="192-168-1-4"><a href="#192-168-1-4" class="headerlink" title="192.168.1.4"></a>192.168.1.4</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># hostnamectl set-hostname jenkins</span></span><br><span class="line">[root@localhost ~]<span class="comment"># bash</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># vim /etc/hosts</span></span><br><span class="line">192.168.1.1 gitlab</span><br><span class="line">192.168.1.4 jenkins</span><br><span class="line">192.168.1.11 k8s-master</span><br><span class="line">192.168.1.12 k8s-node1</span><br><span class="line">192.168.1.13 k8s-node2</span><br></pre></td></tr></tbody></table></figure>
<p>准备 Java 环境</p>
<p>使用 1.8 的 Java 环境</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># yum -y install java-1.8.0-openjdk*</span></span><br></pre></td></tr></tbody></table></figure>
<p>编写 Jenkins 的 repo 源</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># cat &lt;&lt;EOF&gt; /etc/yum.repos.d/jenkins.repo</span></span><br><span class="line">[jenkins]</span><br><span class="line">name=Jenkins-stable</span><br><span class="line">baseurl=https://mirrors.tuna.tsinghua.edu.cn/jenkins/redhat-stable/</span><br><span class="line">gpgcheck=1</span><br><span class="line">EOF</span><br><span class="line"><span class="comment"># 导入rpm密钥</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># rpm --import https://pkg.jenkins.io/redhat-stable/jenkins.io.key</span></span><br></pre></td></tr></tbody></table></figure>
<p>安装 Jenkins</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># yum -y install https://mirrors.tuna.tsinghua.edu.cn/jenkins/redhat-stable/jenkins-2.235.1-1.1.noarch.rpm</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># yum -y install git</span></span><br></pre></td></tr></tbody></table></figure>
<p>安装加速神奇，Jenkins 默认使用 google 来搜索插件的下载，而且插件也在国外网站，这里将 updates 目录中的 <code>default.json</code> 内的 url 换为百度（搜索引擎）和清华（下载插件地址），<strong>前提必须出现过以上界面才会有 updates 目录</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># sed -i 's/http:\/\/www.google.com/https:\/\/www.baidu.com/g' /var/lib/jenkins/updates/default.json</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># sed -i 's/http:\/\/updates.jenkins-ci.org\/download/https:\/\/mirrors.tuna.tsinghua.edu.cn\/jenkins/g' /var/lib/jenkins/updates/default.json</span></span><br></pre></td></tr></tbody></table></figure>
<p>启动 Jenkins，并放行 8080 端口</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># systemctl start jenkins</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># systemctl enable jenkins</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># firewall-cmd --permanent --add-port=8080/tcp</span></span><br><span class="line">success</span><br><span class="line">[root@jenkins ~]<span class="comment"># firewall-cmd --reload</span></span><br><span class="line">success</span><br></pre></td></tr></tbody></table></figure>
<p>进入 Jenkins 的 web 安装界</p>
<p>访问 <code>http://192.168.1.4:8080</code></p>
<p><img src="https://www.feiyiblog.com/uploads/wait_jiemian.png" alt="Jenkins"></p>
<p>在 Linux 本地查看管理员密码</p>
<p><img src="https://www.feiyiblog.com/uploads/lock_jenkins.png" alt="Jenkins"></p>
<p>输入密码后，如果出现此界面</p>
<p><img src="https://www.feiyiblog.com/uploads/shaowait.png" alt="Jenkins"></p>
<p>如果出现以下</p>
<p><img src="https://www.feiyiblog.com/uploads/lixian.png" alt="Jenkins"></p>
<p>解决方法如下：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">第一步 打开插件管理的高级设置页面</span><br><span class="line">http://192.168.1.4:8080/pluginManager/advanced</span><br><span class="line"></span><br><span class="line">第二步 修改更新站点地址</span><br><span class="line">将https改为http  如果不行 可以用清华的加速站点 如下</span><br><span class="line">https://mirrors.tuna.tsinghua.edu.cn/jenkins/updates/update-center.json</span><br></pre></td></tr></tbody></table></figure>
<p>安装推荐插件</p>
<p><img src="https://www.feiyiblog.com/uploads/install_chajian.png" alt="Jenkins"></p>
<p><img src="https://www.feiyiblog.com/uploads/wait_install.png" alt="Jenkins"></p>
<p>然后重启服务，并重新访问 Jenkins 的 web 界面</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># systemctl restart jenkins</span></span><br></pre></td></tr></tbody></table></figure>
<p>安装完成后，创建管理用户</p>
<p><img src="https://www.feiyiblog.com/uploads/create_jenkins_user.png" alt="Jenkins"></p>
<p><img src="https://www.feiyiblog.com/uploads/shili_config.png" alt="Jenkins"></p>
<p><img src="https://www.feiyiblog.com/uploads/jenkins_install_success.png" alt="Jenkins"></p>
<p>在插件管理中安装三个关于 GitLab 的插件，用于持续集成</p>
<blockquote>
<p>Gitlab Authentication</p>
<p>Gitlab</p>
<p>Gitlab Hook</p>
</blockquote>
<p>选择安装后自动重启 Jenkins</p>
<h1 id="搭建Kubernetes集群"><a href="#搭建Kubernetes集群" class="headerlink" title="搭建Kubernetes集群"></a>搭建 Kubernetes 集群</h1><p>参考本站文档 <a href="https://www.feiyiblog.com/2020/03/23/安装Docker——镜像加速/" target="_blank" rel="noopener">Docker 安装</a>和 <a href="https://www.feiyiblog.com/2020/04/17/kubernetes安装及集群搭建/" target="_blank" rel="noopener">Kubernetes 集群搭建</a></p>
<h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><p>按照运行环境中的系统版本和硬件要求</p>
<p>这里使用的现成的 Docker 环境，没有的可以参考以上链接部署</p>
<h3 id="更改主机名"><a href="#更改主机名" class="headerlink" title="更改主机名"></a>更改主机名</h3><p><strong>192.168.1.11</strong></p>
<p>更改主机名，并设置对其他两台节点的免密登录</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># hostnamectl set-hostname k8s-master</span></span><br><span class="line">[root@localhost ~]<span class="comment"># bash</span></span><br><span class="line">[root@k8s-master ~]<span class="comment"># vim /etc/hosts</span></span><br><span class="line">192.168.1.11 k8s-master</span><br><span class="line">192.168.1.12 k8s-node1</span><br><span class="line">192.168.1.13 k8s-node2</span><br><span class="line">[root@k8s-master ~]<span class="comment"># ssh-keygen</span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa):</span><br><span class="line">Created directory <span class="string">'/root/.ssh'</span>.</span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase):</span><br><span class="line">Enter same passphrase again:</span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:y0cMv9gJDShPYbfH/+WUbwtLJivwGTNv4EVT6TpxXHQ root@k8s-master</span><br><span class="line">The key<span class="string">'s randomart image is:</span></span><br><span class="line"><span class="string">+---[RSA 2048]----+</span></span><br><span class="line"><span class="string">|      o .     o.E|</span></span><br><span class="line"><span class="string">|     . + o   o ..|</span></span><br><span class="line"><span class="string">|    . o + o + .  |</span></span><br><span class="line"><span class="string">|     +   B = +  .|</span></span><br><span class="line"><span class="string">|      . S * *  .o|</span></span><br><span class="line"><span class="string">|       o @ * . +.|</span></span><br><span class="line"><span class="string">|        B &amp;..+. +|</span></span><br><span class="line"><span class="string">|         * o= o..|</span></span><br><span class="line"><span class="string">|          o. . . |</span></span><br><span class="line"><span class="string">+----[SHA256]-----+</span></span><br><span class="line"><span class="string">[root@k8s-master ~]# ssh-copy-id -i root@k8s-node1</span></span><br><span class="line"><span class="string">[root@k8s-master ~]# ssh-copy-id -i root@k8s-node2</span></span><br></pre></td></tr></tbody></table></figure>
<p>将 hosts 文件传输到其他两台节点</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># scp /etc/hosts root@k8s-node1:/etc</span></span><br><span class="line">[root@k8s-master ~]<span class="comment"># scp /etc/hosts root@k8s-node2:/etc</span></span><br></pre></td></tr></tbody></table></figure>
<p><strong>192.168.1.12</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># hostnamectl set-hostname k8s-node1</span></span><br><span class="line">[root@localhost ~]<span class="comment"># bash</span></span><br><span class="line">[root@k8s-node1 ~]<span class="comment">#</span></span><br></pre></td></tr></tbody></table></figure>
<p><strong>192.168.1.13</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># hostnamectl set-hostname k8s-node2</span></span><br><span class="line">[root@localhost ~]<span class="comment"># bash</span></span><br><span class="line">[root@k8s-node2 ~]<span class="comment">#</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="关闭沙盒"><a href="#关闭沙盒" class="headerlink" title="关闭沙盒"></a>关闭沙盒</h3><p><strong>k8s-master/node1/node2</strong></p>
<p>将 SELinux 设置为禁用（也可以设置为 permissive 模式）</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># setenforce 0</span></span><br><span class="line">[root@k8s-master ~]<span class="comment"># sed -i 's/^SELINUX=enforcing$/SELINUX=disabled/' /etc/selinux/config</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="开放所需端口"><a href="#开放所需端口" class="headerlink" title="开放所需端口"></a>开放所需端口</h3><p>防火墙放行端口，因为比较多，省事可以直接 <code>systemctl stop firewalld</code></p>
<p><strong>master 节点</strong></p>
<table>
<thead>
<tr>
<th>协议</th>
<th>方向</th>
<th>端口范围</th>
<th>作用</th>
<th>使用者</th>
</tr>
</thead>
<tbody>
<tr>
<td> TCP</td>
<td> 入站</td>
<td> 6443*</td>
<td>Kubernetes API 服务器</td>
<td>所有组件</td>
</tr>
<tr>
<td> TCP</td>
<td> 入站</td>
<td> 2379-2380</td>
<td>etcd server client API</td>
<td>kube-apiserver, etcd</td>
</tr>
<tr>
<td>TCP</td>
<td> 入站</td>
<td> 10250</td>
<td>Kubelet API</td>
<td>kubelet 自身、控制平面组件</td>
</tr>
<tr>
<td> TCP</td>
<td> 入站</td>
<td> 10251</td>
<td>kube-scheduler</td>
<td>kube-scheduler 自身</td>
</tr>
<tr>
<td> TCP</td>
<td> 入站</td>
<td> 10252</td>
<td>kube-controller-manager</td>
<td>kube-controller-manager 自身 </td>
</tr>
</tbody>
</table>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># firewall-cmd --permanent --add-port=6443/tcp</span></span><br><span class="line">[root@k8s-master ~]<span class="comment"># firewall-cmd --permanent --add-port=64430-64439/tcp</span></span><br><span class="line">[root@k8s-master ~]<span class="comment"># firewall-cmd --permanent --add-port=2379-2380/tcp</span></span><br><span class="line">[root@k8s-master ~]<span class="comment"># firewall-cmd --permanent --add-port=10250-10252/tcp</span></span><br><span class="line">[root@k8s-master ~]<span class="comment"># firewall-cmd --reload</span></span><br></pre></td></tr></tbody></table></figure>
<p><strong>所有 node 工作节点</strong></p>
<table>
<thead>
<tr>
<th>协议</th>
<th>方向</th>
<th>端口范围</th>
<th>作用</th>
<th>使用者</th>
</tr>
</thead>
<tbody>
<tr>
<td> TCP</td>
<td> 入站</td>
<td> 10250</td>
<td>Kubelet API</td>
<td>kubelet 自身、控制平面组件</td>
</tr>
<tr>
<td> TCP</td>
<td> 入站</td>
<td> 30000-32767</td>
<td>NodePort 服务 **</td>
<td> 所有组件 </td>
</tr>
</tbody>
</table>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-node1 ~]<span class="comment"># firewall-cmd --permanent --add-port=10250/tcp</span></span><br><span class="line">[root@k8s-node1 ~]<span class="comment"># firewall-cmd --permanent --add-port=30000-32767/tcp</span></span><br><span class="line">[root@k8s-node1 ~]<span class="comment"># firewall-cmd --reload</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="验证节点UUID"><a href="#验证节点UUID" class="headerlink" title="验证节点UUID"></a>验证节点 UUID</h3><p>查看每个服务器的 uuid，必须不能重复</p>
<p><strong>k8s-master</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># cat /sys/class/dmi/id/product_uuid</span></span><br><span class="line">E2B74D56-23A9-4E8B-620C-555387355616</span><br></pre></td></tr></tbody></table></figure>
<h3 id="关闭swap分区"><a href="#关闭swap分区" class="headerlink" title="关闭swap分区"></a>关闭 swap 分区</h3><p>三台节点同样的操作</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># swapoff -a</span></span><br><span class="line">[root@k8s-master ~]<span class="comment"># vim /etc/fstab</span></span><br><span class="line"><span class="comment"># 将分区类型为swap的一行注释掉</span></span><br><span class="line">/dev/mapper/centos-swap swap</span><br><span class="line"><span class="comment"># 还是需要调整内核参数</span></span><br><span class="line">[root@k8s-master ~]<span class="comment"># vim /etc/sysctl.conf</span></span><br><span class="line"><span class="comment"># 末尾添加</span></span><br><span class="line">vm.swappiness = 0</span><br><span class="line">[root@k8s-master ~]<span class="comment"># sysctl -p</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="设置内核参数"><a href="#设置内核参数" class="headerlink" title="设置内核参数"></a>设置内核参数</h3><p>调整 iptables 桥接流量，依赖于 docker 的启动，所以需要确保 docker 已经启动</p>
<p><strong>k8s-master</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># vim /etc/sysctl.conf</span></span><br><span class="line"><span class="comment"># 末尾添加</span></span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">[root@k8s-master ~]<span class="comment"># sysctl -p</span></span><br><span class="line"><span class="comment"># 为确保桥接流量不报错，执行以下命令</span></span><br><span class="line">[root@k8s-master ~]<span class="comment"># modprobe ip_vs_rr</span></span><br><span class="line">[root@k8s-master ~]<span class="comment"># modprobe br_netfilter</span></span><br><span class="line"><span class="comment"># 将修改好的文件传输到node1和node2</span></span><br><span class="line">[root@k8s-master ~]<span class="comment"># scp /etc/sysctl.conf root@k8s-node1:/etc</span></span><br><span class="line">[root@k8s-master ~]<span class="comment"># scp /etc/sysctl.conf root@k8s-node2:/etc</span></span><br></pre></td></tr></tbody></table></figure>
<p><strong>k8s-node1</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-node1 ~]<span class="comment"># sysctl -p</span></span><br><span class="line">[root@k8s-node1 ~]<span class="comment"># modprobe ip_vs_rr</span></span><br><span class="line">[root@k8s-node1 ~]<span class="comment"># modprobe br_netfilter</span></span><br></pre></td></tr></tbody></table></figure>
<p><strong>k8s-node2</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-node2 ~]<span class="comment"># sysctl -p</span></span><br><span class="line">[root@k8s-node2 ~]<span class="comment"># modprobe ip_vs_rr</span></span><br><span class="line">[root@k8s-node2 ~]<span class="comment"># modprobe br_netfilter</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="安装Kubernetes"><a href="#安装Kubernetes" class="headerlink" title="安装Kubernetes"></a>安装 Kubernetes</h2><h3 id="编写yum源"><a href="#编写yum源" class="headerlink" title="编写yum源"></a>编写 yum 源</h3><p><strong>k8s-master</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># vim /etc/yum.repos.d/kubernetes.repo</span></span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br></pre></td></tr></tbody></table></figure>
<p>将 yum 源传给每台节点</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># scp /etc/yum.repos.d/kubernetes.repo root@k8s-node1:/etc/yum.repos.d/</span></span><br><span class="line">[root@k8s-master ~]<span class="comment"># scp /etc/yum.repos.d/kubernetes.repo root@k8s-node2:/etc/yum.repos.d/</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="安装k8s"><a href="#安装k8s" class="headerlink" title="安装k8s"></a>安装 k8s</h3><p><strong>k8s-master/node1/node2</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># yum -y install kubelet kubeadm kubectl</span></span><br></pre></td></tr></tbody></table></figure>
<p>如果有的节点在 yum 安装时，报错 404，尝试执行 <code>rm -rf /var/cache/yum/*</code> 后，重新安装</p>
<p>查看 k8s 版本</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># kubeadm version</span></span><br><span class="line">kubeadm version: &amp;version.Info{Major:<span class="string">"1"</span>, Minor:<span class="string">"18"</span>, GitVersion:<span class="string">"v1.18.2"</span>,</span><br><span class="line">GitCommit:<span class="string">"52c56ce7a8272c798dbc29846288d7cd9fbae032"</span>, GitTreeState:<span class="string">"clean"</span>,</span><br><span class="line">BuildDate:<span class="string">"2020-04-16T11:54:15Z"</span>, GoVersion:<span class="string">"go1.13.9"</span>, Compiler:<span class="string">"gc"</span>,</span><br><span class="line">Platform:<span class="string">"linux/amd64"</span>}</span><br></pre></td></tr></tbody></table></figure>
<p><strong>k8s-master</strong></p>
<p>安装 kubernetes 的 tab 快捷键，只需要在 master 安装即可</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># yum -y install bash-completion</span></span><br><span class="line">[root@k8s-master ~]<span class="comment"># echo "source &lt;(kubectl completion bash)" &gt;&gt; ~/.bashrc &amp;&amp; bash</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="启动k8s"><a href="#启动k8s" class="headerlink" title="启动k8s"></a>启动 k8s</h3><p><strong>k8s-master/node1/node2</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># systemctl enable --now kubelet</span></span><br></pre></td></tr></tbody></table></figure>
<h2 id="Kubernetes集群搭建"><a href="#Kubernetes集群搭建" class="headerlink" title="Kubernetes集群搭建"></a>Kubernetes 集群搭建</h2><p><strong>k8s-master</strong></p>
<p>初始化集群，完成后获取 token 值</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># kubeadm init --apiserver-advertise-address 192.168.1.11 \</span></span><br><span class="line">--image-repository registry.aliyuncs.com/google_containers \</span><br><span class="line">--kubernetes-version v1.18.2 --pod-network-cidr=10.244.0.0/16</span><br></pre></td></tr></tbody></table></figure>
<p>使用管理用户（非 root）执行以下操作</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># mkdir -p $HOME/.kube</span></span><br><span class="line">[admin@k8s-master ~]$ sudo cp -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">[admin@k8s-master ~]$ sudo chown $(id -u):$(id -g) <span class="variable">$HOME</span>/.kube/config</span><br></pre></td></tr></tbody></table></figure>
<p>使用 root 用户执行以下操作</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># echo "export KUBECONFIG=/etc/kubernetes/admin.conf" &gt;&gt; ~/.bashrc &amp;&amp; source ~/.bashrc</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="部署集群网络"><a href="#部署集群网络" class="headerlink" title="部署集群网络"></a>部署集群网络</h3><p>下载 flannel 网络配置文件，有时候会下载失败，前往 <a href="https://github.com/coreos/flannel/blob/master/Documentation/kube-flannel.yml" target="_blank" rel="noopener">coreos/flannel 项目</a>手动将内容复制到 <code>kube-flannel.yml</code> 文件中</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># curl -LO https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span></span><br><span class="line"><span class="comment"># 将quay.io改为国内quay-mirror.qiniu.com</span></span><br><span class="line">[root@k8s-master ~]<span class="comment"># sed -i s/quay.io/quay-mirror.qiniu.com/g kube-flannel.yml</span></span><br></pre></td></tr></tbody></table></figure>
<p>然后执行以下操作</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># kubectl apply -f kube-flannel.yml</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="节点加入集群"><a href="#节点加入集群" class="headerlink" title="节点加入集群"></a>节点加入集群</h3><p>如果之前生成的 token 值忘了，查看 <code>kubeadm token list</code>，还能往上翻看到 token 值就跳过这步</p>
<p><strong>k8s-master</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># kubeadm token list</span></span><br><span class="line">TOKEN                     TTL         EXPIRES                     USAGES</span><br><span class="line">jppmrh.1hovp0cyt4xu2w1l   23h         2020-05-11T02:05:53+08:00   authentication,signing</span><br><span class="line"><span class="comment"># 将它删除重新生成</span></span><br><span class="line">[root@k8s-master ~]<span class="comment"># kubeadm token delete jppmrh.1hovp0cyt4xu2w1l</span></span><br></pre></td></tr></tbody></table></figure>
<p>如果找不到了，重新生成</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># kubeadm token create --print-join-command</span></span><br></pre></td></tr></tbody></table></figure>
<p><strong>k8s-node1/node2</strong></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-node1 ~]<span class="comment"># kubeadm join 192.168.1.11:6443 --token bdsiop.8ptt7ky6t088xyl8 \</span></span><br><span class="line">    --discovery-token-ca-cert-hash sha256:1b61fd611bd12f46c7c065995f304ad232f2a598cb99127ccc547612ea57eac0</span><br></pre></td></tr></tbody></table></figure>
<p>输出信息为以下则成功</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Run 'kubectl get nodes' on the control-plane to see this node join the cluster.</span><br></pre></td></tr></tbody></table></figure>
<h3 id="验证集群节点"><a href="#验证集群节点" class="headerlink" title="验证集群节点"></a>验证集群节点</h3><p><strong>k8s-master</strong></p>
<p>等待一段时间，直至状态全部为 Ready</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># kubectl get nodes</span></span><br><span class="line">NAME         STATUS   ROLES    AGE     VERSION</span><br><span class="line">k8s-master   Ready    master   10m     v1.18.2</span><br><span class="line">k8s-node1    Ready    &lt;none&gt;   3m56s   v1.18.2</span><br><span class="line">k8s-node2    Ready    &lt;none&gt;   3m56s   v1.18.2</span><br></pre></td></tr></tbody></table></figure>
<p>集群搭建成功</p>
<h1 id="运行Docker私库—Registry"><a href="#运行Docker私库—Registry" class="headerlink" title="运行Docker私库—Registry"></a>运行 Docker 私库 —Registry</h1><p>为了在环境中更好的管理 Docker 镜像，决定使用 Registry 来运行一个容器，用来存放 docker 镜像，也减少了镜像存储在国外源或者国内源的传输效率，当然也能使用 harbor 私库代替 Registry</p>
<p><strong>k8s-master</strong></p>
<p>创建镜像存放目录</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># mkdir -p /data/docker/registry</span></span><br></pre></td></tr></tbody></table></figure>
<p>下载镜像</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># docker pull registry:2</span></span><br></pre></td></tr></tbody></table></figure>
<p>运行私库容器</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># docker run -itd -p 5000:5000 --restart always \</span></span><br><span class="line">--volume /data/docker/registry/:/var/lib/registry registry:2</span><br></pre></td></tr></tbody></table></figure>
<p>查看端口是否映射成功</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># netstat -anput | grep 5000</span></span><br></pre></td></tr></tbody></table></figure>
<p>检查能否访问到私库</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># firewall-cmd --permanent --add-port=5000/tcp</span></span><br><span class="line">[root@k8s-master ~]<span class="comment"># firewall-cmd --reload</span></span><br><span class="line">[root@k8s-master ~]<span class="comment"># curl 192.168.1.11:5000/v2/_catalog</span></span><br><span class="line">{<span class="string">"repositories"</span>:[]}</span><br></pre></td></tr></tbody></table></figure>
<p>设置三台 docker 都能识别私库地址</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># vim /usr/lib/systemd/system/docker.service</span></span><br><span class="line"><span class="comment"># 以ExecStart开头的一行的末尾添加--insecure-registry 192.168.1.11:5000</span></span><br><span class="line">[root@k8s-master ~]<span class="comment"># scp /usr/lib/systemd/system/docker.service root@k8s-node1:/usr/lib/systemd/system/</span></span><br><span class="line">[root@k8s-master ~]<span class="comment"># scp /usr/lib/systemd/system/docker.service root@k8s-node2:/usr/lib/systemd/system/</span></span><br></pre></td></tr></tbody></table></figure>
<p>全部重启 docker</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># systemctl daemon-reload &amp;&amp; systemctl restart docker</span></span><br></pre></td></tr></tbody></table></figure>
<p>制作一个镜像上传到私库测试</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># wget http://nginx.org/download/nginx-1.11.1.tar.gz</span></span><br><span class="line">[root@k8s-master ~]<span class="comment"># vim Dockerfile</span></span><br><span class="line">FROM centos</span><br><span class="line">MAINTAINER FeiYi</span><br><span class="line">RUN yum -y install net-tools iproute pcre-devel openssl-devel gcc gcc-c++ make zlib-devel elinks</span><br><span class="line">ADD nginx-1.11.1.tar.gz /usr/src</span><br><span class="line">ENV NGINX_DIR /usr/src/nginx-1.11.1</span><br><span class="line">WORKDIR <span class="variable">$NGINX_DIR</span></span><br><span class="line">RUN ./configure --prefix=/usr/<span class="built_in">local</span>/nginx --user=nginx --group=nginx &amp;&amp; make &amp;&amp; make install</span><br><span class="line">WORKDIR /</span><br><span class="line">RUN useradd nginx</span><br><span class="line">RUN ln -s /usr/<span class="built_in">local</span>/nginx/sbin/nginx /usr/sbin/nginx</span><br><span class="line">EXPOSE 80</span><br><span class="line">CMD [<span class="string">"nginx"</span>, <span class="string">"-g"</span>, <span class="string">"daemon off;"</span>]</span><br></pre></td></tr></tbody></table></figure>
<p>构建镜像</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># docker build -t 192.168.1.11:5000/bin-nginx:latest /root</span></span><br></pre></td></tr></tbody></table></figure>
<p>上传镜像</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master ~]<span class="comment"># docker push 192.168.1.11:5000/bin-nginx</span></span><br><span class="line">[root@k8s-master ~]<span class="comment"># curl 192.168.1.11:5000/v2/_catalog</span></span><br><span class="line">{<span class="string">"repositories"</span>:[<span class="string">"bin-nginx"</span>]}</span><br></pre></td></tr></tbody></table></figure>
<p>私库成功</p>
<h1 id="使用k8s启动nginx容器"><a href="#使用k8s启动nginx容器" class="headerlink" title="使用k8s启动nginx容器"></a>使用 k8s 启动 nginx 容器</h1><p><strong>k8s-master</strong></p>
<h2 id="编写Deployment的模板文件"><a href="#编写Deployment的模板文件" class="headerlink" title="编写Deployment的模板文件"></a>编写 Deployment 的模板文件</h2><figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># vim nginx-deployment.yml</span></span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  replicas: 2</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: 192.168.1.11:5000/bin-nginx</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br></pre></td></tr></tbody></table></figure>
<p>运行模板文件</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># kubectl apply -f nginx-deployment.yml</span></span><br><span class="line">deployment.apps/nginx created</span><br></pre></td></tr></tbody></table></figure>
<p>查看是否运行成功</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># kubectl get pod -o wide</span></span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE    IP           NODE</span><br><span class="line">nginx-66fb94d868-h2fkk   1/1     Running   0          2m5s   10.244.2.2   node2</span><br><span class="line">nginx-66fb94d868-zhkf8   1/1     Running   0          2m5s   10.244.1.2   node3</span><br></pre></td></tr></tbody></table></figure>
<p>可以看到容器的 ip，现在只能在运行容器的节点才能够访问到页面内容，如果想让外部主机访问到，需要做一个 service 模板，用来映射端口</p>
<h2 id="编写Service模板"><a href="#编写Service模板" class="headerlink" title="编写Service模板"></a>编写 Service 模板</h2><p>将集群中标签为 app: nginx 的容器的 80 端口映射为服务器的 30001</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># vim nginx-service.yml</span></span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx</span><br><span class="line">spec:</span><br><span class="line">  <span class="built_in">type</span>: NodePort</span><br><span class="line">  ports:</span><br><span class="line">  - port: 80</span><br><span class="line">    targetPort: 80</span><br><span class="line">    nodePort: 30001</span><br><span class="line">  selector:</span><br><span class="line">    app: nginx</span><br></pre></td></tr></tbody></table></figure>
<p>运行 Service 模板</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]<span class="comment"># kubectl apply -f nginx-service.yml</span></span><br><span class="line">service/nginx created</span><br></pre></td></tr></tbody></table></figure>
<p>访问宿主机的 30001 端口</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.12:30001`和`http://192.168.1.13:30001</span><br></pre></td></tr></tbody></table></figure>
<p><img src="https://jf.ssjinyao.com/uploads/k8s_nginx.png" alt="k8s_nginx"></p>
<p>容器部署成功</p>
<h1 id="整合GitLab和Jenkins"><a href="#整合GitLab和Jenkins" class="headerlink" title="整合GitLab和Jenkins"></a>整合 GitLab 和 Jenkins</h1><p><strong>Jenkins</strong></p>
<p>在 Jenkins 生成密钥对</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># ssh-keygen</span></span><br><span class="line">Generating public/private rsa key pair.</span><br><span class="line">Enter file <span class="keyword">in</span> <span class="built_in">which</span> to save the key (/root/.ssh/id_rsa):</span><br><span class="line">Created directory <span class="string">'/root/.ssh'</span>.</span><br><span class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase):</span><br><span class="line">Enter same passphrase again:</span><br><span class="line">Your identification has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.</span><br><span class="line">Your public key has been saved <span class="keyword">in</span> /root/.ssh/id_rsa.pub.</span><br><span class="line">The key fingerprint is:</span><br><span class="line">SHA256:IITvkptc3nJrgxCxA0R0+ExWm5y/PfSIdKaQpD0NhUc root@jenkins</span><br><span class="line">The key<span class="string">'s randomart image is:</span></span><br><span class="line"><span class="string">+---[RSA 2048]----+</span></span><br><span class="line"><span class="string">|++.oo.oE         |</span></span><br><span class="line"><span class="string">|..++..=.         |</span></span><br><span class="line"><span class="string">| .=+.Bo          |</span></span><br><span class="line"><span class="string">|  +o=.=.         |</span></span><br><span class="line"><span class="string">|   * = +S+       |</span></span><br><span class="line"><span class="string">|  + o + O o      |</span></span><br><span class="line"><span class="string">| . B o + + .     |</span></span><br><span class="line"><span class="string">|  + + =   .      |</span></span><br><span class="line"><span class="string">|     +.o         |</span></span><br><span class="line"><span class="string">+----[SHA256]-----+</span></span><br></pre></td></tr></tbody></table></figure>
<p><strong>GitLab</strong></p>
<p>登录 GitLab</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.1</span><br></pre></td></tr></tbody></table></figure>
<p>创建项目仓库</p>
<p><img src="https://jf.ssjinyao.com/uploads/admin_create_project.png" alt="gitlab"></p>
<p><img src="https://jf.ssjinyao.com/uploads/k8s_gitlab.png" alt="k8s_gitlab"></p>
<p>在 GitLab 中添加 Jenkins 的公钥值</p>
<p><img src="https://jf.ssjinyao.com/uploads/add_id_rsa_pub.png" alt="gitlab"></p>
<p>复制 Jenkins 服务器的公钥到下图位置，查看公钥 <code>cat .ssh/id_rsa.pub</code></p>
<p><img src="https://jf.ssjinyao.com/uploads/k8s_gitlab1.png" alt="k8s_gitlab1"></p>
<p>在 GitLab 的项目仓库，创建一个测试代码文件</p>
<p><img src="https://jf.ssjinyao.com/uploads/k8s_gitlab2.png" alt="k8s_gitlab2"></p>
<p><img src="https://jf.ssjinyao.com/uploads/k8s_gitlab3.png" alt="k8s_gitlab3"></p>
<p>因为密钥上传的是 Jenkins 的，所以在 Jenkins 上下载查看</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># git clone http://192.168.1.1/root/nginx-test.git</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># cd nginx-test/</span></span><br><span class="line">[root@jenkins nginx-test]<span class="comment"># cat index.html</span></span><br><span class="line">ChaiYanjiang</span><br></pre></td></tr></tbody></table></figure>
<p>成功</p>
<p><strong>Jenkins</strong></p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.1.4:8080/</span><br></pre></td></tr></tbody></table></figure>
<p>创建任务 nginx-test</p>
<p><img src="https://jf.ssjinyao.com/uploads/k8s_jenkins.png" alt="k8s_jenkins"></p>
<p>设置源码管理时在 Gitlab 的地址，出现红色说明连接不到，因为 GitLab 已经有了 Jenkins 的公钥，这里只需要填写 Jenkins 的私钥即可</p>
<p><img src="https://jf.ssjinyao.com/uploads/k8s_jenkins2.png" alt="k8s_jenkins2"></p>
<p><img src="https://www.feiyiblog.com/uploads/create_con_gitlab.png" alt="Jenkins"></p>
<p>红色报错消失了</p>
<p><img src="https://www.feiyiblog.com/uploads/choose_pingzheng_gitlab.png" alt="Jenkins"></p>
<p>设置构建触发器</p>
<p>当 gitlab 发生代码变化时，开始进行构建任务</p>
<p><img src="https://jf.ssjinyao.com/uploads/k8s_jenkins3.png" alt="k8s_jenkins3"></p>
<p>生成一串 token 值，用来对 GitLab 中的项目代码进行操作，所以这个值要放到 GitLab 中，用于验证允许 Jenkins 来拿取代码，稍后会将</p>
<p><img src="https://www.feiyiblog.com/uploads/sheng_token.png" alt="k8s_build"></p>
<p>设置构建的命令（CI/CD）</p>
<p><img src="https://jf.ssjinyao.com/uploads/k8s_build.png" alt="k8s_build"></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">backupcode=/data/backupcode/<span class="variable">$JOB_NAME</span>/</span><br><span class="line">mkdir -p <span class="variable">$backupcode</span></span><br><span class="line">chmod 644 <span class="variable">$JENKINS_HOME</span>/workspace/<span class="variable">$JOB_NAME</span>/*</span><br><span class="line">rsync -acP <span class="variable">$JENKINS_HOME</span>/workspace/<span class="variable">$JOB_NAME</span>/* <span class="variable">$backupcode</span></span><br><span class="line"><span class="built_in">echo</span> From 192.168.1.11:5000/bin-nginx &gt; <span class="variable">$JENKINS_HOME</span>/workspace/Dockerfile</span><br><span class="line"><span class="built_in">echo</span> COPY ./nginx-test/* /usr/<span class="built_in">local</span>/nginx/html/ &gt;&gt; <span class="variable">$JENKINS_HOME</span>/workspace/Dockerfile</span><br><span class="line">docker rmi 192.168.1.11:5000/bin-nginx:latest</span><br><span class="line">docker build -t 192.168.1.11:5000/bin-nginx:latest <span class="variable">$JENKINS_HOME</span>/workspace/</span><br><span class="line">docker push 192.168.1.11:5000/bin-nginx:latest</span><br><span class="line">ssh root@k8s-master kubectl delete deployment nginx</span><br><span class="line">ssh root@k8s-master kubectl apply -f nginx-deployment.yml</span><br></pre></td></tr></tbody></table></figure>
<p>保存即可</p>
<p><strong>GitLab</strong></p>
<p>192.168.1.1 中设置 Jenkins 中的 token 值，用来触发 Jenkins 构建</p>
<p>GitLab 默认情况下不允许通过本地网络触发构建，以下这步是为了设置允许本地网络构建，如果不设置允许会在添加 token 时报错</p>
<p><img src="https://www.feiyiblog.com/uploads/admin_settings_integrations.png" alt="GitLab"></p>
<p><img src="https://www.feiyiblog.com/uploads/outbound_requests.png" alt="GitLab"></p>
<p><img src="https://www.feiyiblog.com/uploads/allow_webhooks.png" alt="GitLab"></p>
<p>保存</p>
<p>设置允许之后，就可以设置 GitLab 项目与 Jenkins 的构建触发器连接了</p>
<p><strong>进入项目</strong>中选择设置</p>
<p><img src="https://www.feiyiblog.com/uploads/cd_reops_settings.png" alt="gitlab"></p>
<p>图中的 URL 是在 Jenkins 中的项目路径，这个路径在构建触发器的那里可以看到，复制即可，token 则是刚才在 Jenkins 的管理界面中生成的 token 值，也是同样的位置，然后点击下方 <code>add webhook</code></p>
<p><img src="https://jf.ssjinyao.com/uploads/gitlab_token.png" alt="gitlab_token"></p>
<p>add 成功后，往下翻到如图所示位置可以看添加成功的 URL，然后进行连接测试，出现 200 即成功</p>
<p><img src="https://jf.ssjinyao.com/uploads/gitlab_webhooktest.png" alt="gitlab_webhooktest"></p>
<h1 id="整合Jenkins和Docker"><a href="#整合Jenkins和Docker" class="headerlink" title="整合Jenkins和Docker"></a>整合 Jenkins 和 Docker</h1><p><strong>Jenkins</strong></p>
<p>在 Jenkins 中做对 k8s-master 的免密登录，得先修改 Jenkins 的运行用户，这里我直接用 root 代替，生产环境请参考这里的 <a href="https://www.feiyiblog.com/2020/03/12/GitLab-Jenkins-Tomcat/" target="_blank" rel="noopener">scp 报错部分</a></p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># vim /etc/sysconfig/jenkins</span></span><br><span class="line"> 修改jenkins用户</span><br><span class="line">JENKINS_USER=<span class="string">"jenkins"</span>   <span class="comment"># 修改为root</span></span><br></pre></td></tr></tbody></table></figure>
<p>重启 Jenkins 并传输密钥</p>
<figure class="highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@jenkins ~]<span class="comment"># systemctl restart jenkins</span></span><br><span class="line">[root@jenkins ~]<span class="comment"># ssh-copy-id -i root@k8s-master</span></span><br></pre></td></tr></tbody></table></figure>
<p>安装 Docker，参考文档 <a href="https://www.feiyiblog.com/2020/03/23/安装Docker——镜像加速/" target="_blank" rel="noopener">Docker 安装</a>，并设置镜像加速，和指定私库地址</p>
<h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><p>修改 GitLab 的测试文件测试 Jenkins 的自动化部署是否成功</p>
<p><img src="https://jf.ssjinyao.com/uploads/gitlab_test.png" alt="gitlab_test"></p>
<p>保存后会开始自动构建部署，访问 <code>192.168.1.13:30001</code>，如果是以下则成功，如果构建失败，则检查构建脚本，慢慢排错</p>
<p><img src="https://jf.ssjinyao.com/uploads/k8s_cicd.png" alt="k8s_cicd"></p>
<hr>

      
    </div>

    

    
    
    

    <div>
      
        <div>
    
        <div style="text-align:center;color: #636363;font-size:12px;letter-spacing: 10px"><i class="fa fa-heart"></i>本文结束啦，感谢您的阅读<i class="fa fa-heart"></i><div>
    
</div>
      
    </div>

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Paul Li</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://blog.q-moe.com/2020/07/11/GitLab-Jenkins-K8S-生产环境可CI-CD模拟/" title="GitLab+Jenkins+K8S (生产环境可 CI/CD 模拟)">https://blog.q-moe.com/2020/07/11/GitLab-Jenkins-K8S-生产环境可CI-CD模拟/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/GitLab/" rel="tag"><i class="fa fa-tag"></i> GitLab</a>
          
            <a href="/tags/Jenkins/" rel="tag"><i class="fa fa-tag"></i> Jenkins</a>
          
            <a href="/tags/K8S/" rel="tag"><i class="fa fa-tag"></i> K8S</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/10/06/免费给自己的网站添加HTTPS安全加密/" rel="next" title="免费给自己的网站添加 HTTPS 安全加密">
                <i class="fa fa-chevron-left"></i> 免费给自己的网站添加 HTTPS 安全加密
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2020/07/11/使用acme.sh的DNS API配置生成通配域名证书/" rel="prev" title="使用 acme.sh 的 DNS API 配置生成通配域名证书">
                使用 acme.sh 的 DNS API 配置生成通配域名证书 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </div></div></article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/avatar.jpeg" alt="Paul Li">
            
              <p class="site-author-name" itemprop="name">Paul Li</p>
              <p class="site-description motion-element" itemprop="description">学习，记录，分享</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">21</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">10</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">20</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/sapeu" target="_blank" title="GitHub" rel="external nofollow"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:m@q-moe.com" target="_blank" title="E-Mail" rel="external nofollow"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#运行环境"><span class="nav-number">1.</span> <span class="nav-text">运行环境</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#部署目的"><span class="nav-number">2.</span> <span class="nav-text">部署目的</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#搭建GitLab"><span class="nav-number">3.</span> <span class="nav-text">搭建 GitLab</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#192-168-1-1"><span class="nav-number">3.1.</span> <span class="nav-text">192.168.1.1</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#搭建Jenkins"><span class="nav-number">4.</span> <span class="nav-text">搭建 Jenkins</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#192-168-1-4"><span class="nav-number">4.1.</span> <span class="nav-text">192.168.1.4</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#搭建Kubernetes集群"><span class="nav-number">5.</span> <span class="nav-text">搭建 Kubernetes 集群</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#环境准备"><span class="nav-number">5.1.</span> <span class="nav-text">环境准备</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#更改主机名"><span class="nav-number">5.1.1.</span> <span class="nav-text">更改主机名</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#关闭沙盒"><span class="nav-number">5.1.2.</span> <span class="nav-text">关闭沙盒</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#开放所需端口"><span class="nav-number">5.1.3.</span> <span class="nav-text">开放所需端口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#验证节点UUID"><span class="nav-number">5.1.4.</span> <span class="nav-text">验证节点 UUID</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#关闭swap分区"><span class="nav-number">5.1.5.</span> <span class="nav-text">关闭 swap 分区</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置内核参数"><span class="nav-number">5.1.6.</span> <span class="nav-text">设置内核参数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#安装Kubernetes"><span class="nav-number">5.2.</span> <span class="nav-text">安装 Kubernetes</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#编写yum源"><span class="nav-number">5.2.1.</span> <span class="nav-text">编写 yum 源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装k8s"><span class="nav-number">5.2.2.</span> <span class="nav-text">安装 k8s</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#启动k8s"><span class="nav-number">5.2.3.</span> <span class="nav-text">启动 k8s</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kubernetes集群搭建"><span class="nav-number">5.3.</span> <span class="nav-text">Kubernetes 集群搭建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#部署集群网络"><span class="nav-number">5.3.1.</span> <span class="nav-text">部署集群网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#节点加入集群"><span class="nav-number">5.3.2.</span> <span class="nav-text">节点加入集群</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#验证集群节点"><span class="nav-number">5.3.3.</span> <span class="nav-text">验证集群节点</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#运行Docker私库—Registry"><span class="nav-number">6.</span> <span class="nav-text">运行 Docker 私库 —Registry</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#使用k8s启动nginx容器"><span class="nav-number">7.</span> <span class="nav-text">使用 k8s 启动 nginx 容器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#编写Deployment的模板文件"><span class="nav-number">7.1.</span> <span class="nav-text">编写 Deployment 的模板文件</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#编写Service模板"><span class="nav-number">7.2.</span> <span class="nav-text">编写 Service 模板</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#整合GitLab和Jenkins"><span class="nav-number">8.</span> <span class="nav-text">整合 GitLab 和 Jenkins</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#整合Jenkins和Docker"><span class="nav-number">9.</span> <span class="nav-text">整合 Jenkins 和 Docker</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#测试"><span class="nav-number">10.</span> <span class="nav-text">测试</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">© <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Paul Li</span>

  

  

  <span class="post-meta-divider">|</span>
  <span id="busuanzi_container_site_uv" title="总访客量">
    <i class="fa fa-users"></i>
    <span id="busuanzi_value_site_uv"></span>
  </span>
  <span class="with-love" id="busuanzi_container_site_pv" title="总访问量">
    <i class="fa fa-eye"></i>
    <span id="busuanzi_value_site_pv"></span>
  </span>
</div>


  









  <div class="footer-custom">部署于<a target="_blank" rel="external nofollow" href="https://www.aliyun.com/minisite/goods?userCode=cma2zz5m" title="领取阿里云优惠"><b>阿里云</b></a></div>


        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>





  








  















  
  
    
  

  
  
    
  

  
  
    
  

  
  
    
  

  
  
    
  


  


  

  



  
  


  

  



  
  




  


  



  



  








  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  



  





  

  

  



  

  
  

  

  

  

  

  
  <style>
    .copy-btn {
      display: inline-block;
      padding: 6px 12px;
      font-size: 13px;
      font-weight: 700;
      line-height: 20px;
      color: #333;
      white-space: nowrap;
      vertical-align: middle;
      cursor: pointer;
      background-color: #eee;
      background-image: linear-gradient(#fcfcfc, #eee);
      border: 1px solid #d5d5d5;
      border-radius: 3px;
      user-select: none;
      outline: 0;
    }

    .highlight-wrap .copy-btn {
      transition: opacity .3s ease-in-out;
      opacity: 0;
      padding: 2px 6px;
      position: absolute;
      right: 4px;
      top: 8px;
    }

    .highlight-wrap:hover .copy-btn,
    .highlight-wrap .copy-btn:focus {
      opacity: 1
    }

    .highlight-wrap {
      position: relative;
    }
  </style>
  




<script type="text/javascript" src="/bundle.js"></script><script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(function (item) {
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'uVrWksb9NK5I8i56re66NDgN-gzGzoHsz',
        appKey: '2wggkIbUjX9QviWExABzVdgY',
        placeholder: '吐槽一下博主',
        avatar:'mm',
        meta:guest,
        pageSize:'10' || 10,
        visitor: true
    });
  ;

(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
;

    $('.highlight').each(function (i, e) {
      var $wrap = $('<div>').addClass('highlight-wrap')
      $(e).after($wrap)
      $wrap.append($('<button>').addClass('copy-btn').append('复制').on('click', function (e) {
        var code = $(this).parent().find('.code').find('.line').map(function (i, e) {
          return $(e).text()
        }).toArray().join('\n')
        var ta = document.createElement('textarea')
        document.body.appendChild(ta)
        ta.style.position = 'absolute'
        ta.style.top = '0px'
        ta.style.left = '0px'
        ta.value = code
        ta.select()
        ta.focus()
        var result = document.execCommand('copy')
        document.body.removeChild(ta)
        
          if(result)$(this).text('复制成功')
          else $(this).text('复制失败')
        
        $(this).blur()
      })).on('mouseleave', function (e) {
        var $b = $(this).find('.copy-btn')
        setTimeout(function () {
          $b.text('复制')
        }, 300)
      }).append(e)
    })
  </script></body></html>